# Change Log

All notable changes to this project will be documented in this file
automatically by Versionist. DO NOT EDIT THIS FILE MANUALLY!
This project adheres to [Semantic Versioning](http://semver.org/).

# v11.30.16
## (2024-05-01)


<details>
<summary> Update balena/open-balena-base Docker tag to v17.0.18 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-17.0.18
> ### (2024-05-01)
> 
> * Update ghcr.io/balena-io-modules/confd-releases Docker tag to v0.0.3 [Self-hosted Renovate Bot]
> 

</details>

# v11.30.15
## (2024-05-01)


<details>
<summary> Update balena/open-balena-base Docker tag to v17.0.17 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-17.0.17
> ### (2024-05-01)
> 
> * Install confd from pre-packaged OCI [Kyle Harding]
> 

</details>

# v11.30.14
## (2024-05-01)

* Run docker build and test on Actuated [Kyle Harding]

# v11.30.13
## (2024-04-30)


<details>
<summary> Update balena/open-balena-base Docker tag to v17.0.16 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-17.0.16
> ### (Invalid date)
> 
> * Update dependency npm to v10.7.0 [Self-hosted Renovate Bot]
> 

</details>

# v11.30.12
## (2024-04-29)

* Update Rust crate ureq to 2.9.7 [Self-hosted Renovate Bot]

# v11.30.11
## (2024-04-29)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.30.10
## (2024-04-25)


<details>
<summary> Update balena/open-balena-base Docker tag to v17.0.15 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-17.0.15
> ### (2024-04-25)
> 
> * Update dependency npm to v10.6.0 [Self-hosted Renovate Bot]
> 

</details>

# v11.30.9
## (2024-04-22)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.30.8
## (2024-04-15)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.30.7
## (2024-04-12)

* Update Rust crate ureq to 2.9.6 [Self-hosted Renovate Bot]

# v11.30.6
## (2024-04-12)

* Update dependency husky to v9 [Self-hosted Renovate Bot]

# v11.30.5
## (2024-04-12)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.30.4
## (2024-04-12)

* Update Rust crate ureq to 2.9.5 [Self-hosted Renovate Bot]

# v11.30.3
## (2024-04-12)


<details>
<summary> Update balena/open-balena-base Docker tag to v17.0.14 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-17.0.14
> ### (2024-04-10)
> 
> * Update dependency npm to v10.5.2 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-17.0.13
> ### (2024-04-10)
> 
> * Update dependency node to v21.7.3 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-17.0.12
> ### (2024-04-03)
> 
> * Update dependency node to v21.7.2 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-17.0.11
> ### (2024-04-03)
> 
> * Update dependency npm to v10.5.1 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-17.0.10
> ### (2024-03-08)
> 
> * Update dependency node to v21.7.1 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-17.0.9
> ### (2024-03-06)
> 
> * Update dependency node to v21.7.0 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-17.0.8
> ### (2024-02-28)
> 
> * Update dependency npm to v10.5.0 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-17.0.7
> ### (2024-02-27)
> 
> * Fix docker cache-from for no-system variants [Kyle Harding]
> 
> ## open-balena-base-17.0.6
> ### (2024-02-27)
> 
> * Move the no-systemd compatibility tag to a suffix [Kyle Harding]
> 
> ## open-balena-base-17.0.5
> ### (2024-02-14)
> 
> * Update dependency node to v21.6.2 [Self-hosted Renovate Bot]
> 

</details>

# v11.30.2
## (2024-04-12)

* Update to @balena/lint 8.x [Pagan Gazzard]

# v11.30.1
## (2024-03-29)

* Update dependency express to v4.19.2 [SECURITY] [Self-hosted Renovate Bot]

# v11.30.0
## (2024-03-13)

* allow OpenVPN carrier protocol configuration [Anton Belodedenko]

# v11.29.36
## (2024-02-09)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.29.35
## (2024-02-04)

* Update dependencies [Pagan Gazzard]

# v11.29.34
## (2024-01-29)

* Switch to using typescript's `Node16` module resolution [Pagan Gazzard]

# v11.29.33
## (2024-01-24)


<details>
<summary> Update balena/open-balena-base Docker tag to v17.0.4 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-17.0.4
> ### (2024-01-24)
> 
> * Update dependency npm to v10.4.0 [Self-hosted Renovate Bot]
> 

</details>

# v11.29.32
## (2024-01-22)


<details>
<summary> Update balena/open-balena-base Docker tag to v17.0.3 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-17.0.3
> ### (2024-01-22)
> 
> * Update dependency node to v21.6.1 [Self-hosted Renovate Bot]
> 

</details>

# v11.29.31
## (2024-01-22)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.29.30
## (2024-01-15)


<details>
<summary> Update balena/open-balena-base Docker tag to v17.0.2 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-17.0.2
> ### (2024-01-15)
> 
> * Update dependency node to v21.6.0 [Self-hosted Renovate Bot]
> 

</details>

# v11.29.29
## (2024-01-15)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.29.28
## (2024-01-10)


<details>
<summary> Update balena/open-balena-base Docker tag to v17.0.1 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-17.0.1
> ### (2024-01-10)
> 
> * Update dependency npm to v10.3.0 [Self-hosted Renovate Bot]
> 

</details>

# v11.29.27
## (2024-01-08)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.29.26
## (2024-01-08)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.29.25
## (2024-01-01)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.29.24
## (2023-12-29)

* Update Rust crate ureq to 2.9.1 [Self-hosted Renovate Bot]

# v11.29.23
## (2023-12-29)

* Lock file maintenance [Self-hosted Renovate Bot]

# v11.29.22
## (2023-12-29)


<details>
<summary> Update dependencies [Pagan Gazzard] </summary>

> ## pinejs-client-request-7.4.0
> ### (2023-12-05)
> 
> * Respect the Retry-After header in request retries [Thodoris Greasidis]
> 

</details>

# v11.29.21
## (2023-12-28)

* Update dependency debian_12/haproxy to v2.6.12-1+deb12u1 [Self-hosted Renovate Bot]

# v11.29.20
## (2023-12-21)


<details>
<summary> Update balena/open-balena-base Docker tag to v17 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-17.0.0
> ### (2023-12-20)
> 
> * Update nodejs to 21.4.0 [Pagan Gazzard]
> 

</details>

# v11.29.19
## (2023-12-21)


<details>
<summary> Update balena/open-balena-base Docker tag to v16.0.18 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-16.0.18
> ### (2023-12-13)
> 
> * add missing data. host [ab77]
> 
> ## open-balena-base-16.0.17
> ### (2023-12-06)
> 
> * Update dependency npm to v10.2.5 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-16.0.16
> ### (2023-12-05)
> 
> * remove self-hosted Sentry config [ab77]
> 
> ## open-balena-base-16.0.15
> ### (2023-11-22)
> 
> * Update dependency node to v20.10.0 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-16.0.14
> ### (2023-11-15)
> 
> * Update dependency npm to v10.2.4 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-16.0.13
> ### (2023-11-02)
> 
> * Update dependency npm to v10.2.3 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-16.0.12
> ### (2023-11-01)
> 
> * Update dependency node to v20.9.0 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-16.0.11
> ### (2023-11-01)
> 
> * Update dependency npm to v10.2.2 [Self-hosted Renovate Bot]
> 

</details>

# v11.29.18
## (2023-12-21)

* Update dependency lint-staged to v15 [Self-hosted Renovate Bot]

# v11.29.17
## (2023-10-18)


<details>
<summary> Update balena/open-balena-base Docker tag to v16.0.10 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-16.0.10
> ### (2023-10-18)
> 
> * Update dependency node to v20.8.1 [Self-hosted Renovate Bot]
> 

</details>

# v11.29.16
## (2023-10-18)


<details>
<summary> Update balena/open-balena-base Docker tag to v16.0.9 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-16.0.9
> ### (2023-10-18)
> 
> * Update dependency npm to v10.2.1 [Self-hosted Renovate Bot]
> 

</details>

# v11.29.15
## (2023-10-03)


<details>
<summary> Update balena/open-balena-base Docker tag to v16.0.8 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-16.0.8
> ### (2023-10-03)
> 
> * Update dependency npm to v10.2.0 [Self-hosted Renovate Bot]
> 

</details>

# v11.29.14
## (2023-10-02)


<details>
<summary> Update balena/open-balena-base Docker tag to v16.0.7 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-16.0.7
> ### (2023-10-02)
> 
> * Prefer using local env var values before falling back to defaults [Thodoris Greasidis]
> 

</details>

# v11.29.13
## (2023-09-29)


<details>
<summary> Update balena/open-balena-base Docker tag to v16.0.6 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-16.0.6
> ### (2023-09-29)
> 
> * Update dependency node to v20.8.0 [Self-hosted Renovate Bot]
> 

</details>

# v11.29.12
## (2023-09-21)


<details>
<summary> Update balena/open-balena-base Docker tag to v16.0.5 [Self-hosted Renovate Bot] </summary>

> ## open-balena-base-16.0.5
> ### (2023-09-21)
> 
> * Build confd from source to avoid upx issues in released binaries [Kyle Harding]
> 

</details>

# v11.29.11
## (2023-09-21)

* Update repo.yml [Kyle Harding]

# v11.29.10
## (2023-09-21)

* Update balena/open-balena-base Docker tag to v16.0.4 [Self-hosted Renovate Bot]

# v11.29.9
## (2023-09-19)

* Update balena/open-balena-base Docker tag to v16.0.3 [Self-hosted Renovate Bot]

# v11.29.8
## (2023-09-18)

* Update balena/open-balena-base Docker tag to v16.0.2 [Self-hosted Renovate Bot]

# v11.29.7
## (2023-09-13)

* Update balena/open-balena-base Docker tag to v16.0.1 [Self-hosted Renovate Bot]

# v11.29.6
## (2023-09-11)

* Update dependencies [Pagan Gazzard]

# v11.29.5
## (2023-09-11)

* Update open-balena-base package.json to specify nodejs 20 [Pagan Gazzard]

# v11.29.4
## (2023-09-11)


<details>
<summary> Update open-balena-base to 16.0.0 [Pagan Gazzard] </summary>

> ## open-balena-base-16.0.0
> ### (2023-09-11)
> 
> * Update nodejs to 20.6.1 and npm to 10.1.0 [Pagan Gazzard]
> 
> ## open-balena-base-15.1.1
> ### (2023-09-07)
> 
> * fix env var resolution from token map [ab77]
> 

</details>

# v11.29.3
## (2023-09-07)

* Update balena/open-balena-base Docker tag to v15.1.0 [Self-hosted Renovate Bot]

# v11.29.2
## (2023-09-07)

* Update balena/open-balena-base Docker tag to v15.0.5 [Self-hosted Renovate Bot]

# v11.29.1
## (2023-08-23)

* Use renovate annotations to manage dockerfile version args [Kyle Harding]

# v11.29.0
## (2023-08-07)

* Add a configurable minimum client drain rate when terminating [Pagan Gazzard]

# v11.28.3
## (2023-07-19)

* Update balena/open-balena-base Docker tag to v15.0.3 [Self-hosted Renovate Bot]

# v11.28.2
## (2023-07-19)

* Update balena/open-balena-base Docker tag to v15.0.2 [Self-hosted Renovate Bot]

# v11.28.1
## (2023-07-18)

* Update balena/open-balena-base Docker tag to v15.0.1 [Self-hosted Renovate Bot]

# v11.28.0
## (2023-07-14)

* Add support for configuring openssl providers [Pagan Gazzard]

# v11.27.2
## (2023-07-10)


<details>
<summary> Update open-balena-base to 15.0.0 [Pagan Gazzard] </summary>

> ## open-balena-base-15.0.0
> ### (2023-07-06)
> 
> * Upgrade to debian bookworm [Pagan Gazzard]
> 

</details>

# v11.27.1
## (2023-07-05)

* Update balena/open-balena-base Docker tag to v14.11.1 [Self-hosted Renovate Bot]

# v11.27.0
## (2023-07-05)

* Update balena/open-balena-base Docker tag to v14.11.0 [Self-hosted Renovate Bot]

# v11.26.11
## (2023-06-29)

* Do not report unauthorized errors to sentry [Pagan Gazzard]

# v11.26.10
## (2023-06-21)

* Update balena/open-balena-base Docker tag to v14.10.2 [Self-hosted Renovate Bot]

# v11.26.9
## (2023-06-21)

* Update balena/open-balena-base Docker tag to v14.10.1 [Self-hosted Renovate Bot]

# v11.26.8
## (2023-06-20)

* Update dependencies [Pagan Gazzard]

# v11.26.7
## (2023-06-19)

* Stop reporting out of sync disconnects to sentry [Pagan Gazzard]

# v11.26.6
## (2023-06-19)

* Gracefully handle not finding service instance for device [Pagan Gazzard]

# v11.26.5
## (2023-06-19)


<details>
<summary> Update dependencies [Pagan Gazzard] </summary>

> ## pinejs-client-request-7.3.7
> ### (2023-06-01)
> 
> * Update flowzone.yml [Kyle Harding]
> 
> ## pinejs-client-request-7.3.6
> ### (2022-09-26)
> 
> * Specify node 10 as the minimum supported node engine in the package.json [Thodoris Greasidis]
> * Replace balenaCI with flowzone [Thodoris Greasidis]
> 
> ## typed-error-3.2.2
> ### (2023-04-20)
> 
> * Delete CODEOWNERS [dfunckt]
> * Update dependencies [Thodoris Greasidis]
> * Replace circleCI with flowzone [Thodoris Greasidis]
> 

</details>

# v11.26.4
## (2023-06-19)


<details>
<summary> Update open-balena-base to 14.10.0 [Pagan Gazzard] </summary>

> ## open-balena-base-14.10.0
> ### (2023-06-07)
> 
> * Update dependency npm to v9.7.1 [Self-hosted Renovate Bot]
> 
> ## open-balena-base-14.9.4
> ### (2023-06-01)
> 
> * Set systemd stopsignal to SIGRTMIN+3 [Pagan Gazzard]
> 

</details>

# v11.26.3
## (2023-06-01)

* test internal contribution [Anton Belodedenko]

# v11.26.2
## (2023-05-30)

* test external contributions [Anton Belodedenko]

# v11.26.1
## (2023-05-30)

* Update balena/open-balena-base Docker tag to v14.9.3 [Self-hosted Renovate Bot]

# v11.26.0
## (2023-05-09)

* Update balena/open-balena-base Docker tag to v14.9.2 [Renovate Bot]

# v11.25.1
## (2023-05-09)

* use eget to update dependencies [ab77]

# v11.25.0
## (2023-04-21)

* Add a configurable (10s default) delay on auth failure [Pagan Gazzard]

# v11.24.0
## (2023-03-22)


<details>
<summary> Update open-balena-base to 14.7.2 [Pagan Gazzard] </summary>

> ## open-balena-base-14.7.2
> ### (2023-03-22)
> 
> * Maintain legacy docker tags behaviour [Kyle Harding]
> 

</details>

# v11.23.0
## (2023-03-21)

* Update balena/open-balena-base Docker tag to v14.7.1 [Renovate Bot]

# v11.22.2
## (2023-03-21)

* Use self-hosted runners to avoid failing cargo builds when emulated [Kyle Harding]

# v11.22.1
## (2023-02-20)

* Update balena/open-balena-base Docker tag to v14.5.1 [Renovate Bot]

# v11.22.0
## (2023-02-17)

* Update balena/open-balena-base Docker tag to v14.5.0 [Renovate Bot]

# v11.21.1
## (2023-02-17)

* Update balena/open-balena-base Docker tag to v14.4.2 [Renovate Bot]

# v11.21.0
## (2023-02-06)

* Update engines entry to specify npm 9 [Pagan Gazzard]

# v11.20.0
## (2023-02-04)

* Update balena/open-balena-base Docker tag to v14.4.1 [Renovate Bot]

# v11.19.1
## (2023-01-30)

* Use `connection draining` in relevant logs rather than `disconnecting` [Pagan Gazzard]

# v11.19.0
## (2023-01-26)

* HAProxy thread control [Anton Belodedenko]

# v11.18.0
## (2023-01-23)

* Update dependency eventemitter3 to 5.0.0 [Renovate Bot]

# v11.17.0
## (2023-01-23)

* Push ping-exit directive to clients rather than ping-restart [Kyle Harding]

# v11.16.0
## (2023-01-20)

* Update npm to 9.3.1 [Renovate Bot]

# v11.15.0
## (2023-01-20)

* Enable builds for arm64 [Kyle Harding]

# v11.14.0
## (2023-01-19)

* Update balena/open-balena-base to 14.2.0 [Kyle Harding]

# v11.13.2
## (2022-11-14)

* Explicitly/consistently use 127.0.0.1 as the openvpn management host [Pagan Gazzard]

# v11.13.1
## (2022-11-09)

* Update balena/open-balena-base Docker tag to v14.0.1 [Renovate Bot]

# v11.13.0
## (2022-10-27)


<details>
<summary> Update open-balena-base to 14.0.0 [Pagan Gazzard] </summary>

> ## open-balena-base-14.0.0
> ### (2022-10-27)
> 
> * Update to nodejs 18 [Pagan Gazzard]
> 
</details>

# v11.12.1
## (2022-10-24)

* Update balena/open-balena-base Docker tag to v13.6.1 [Renovate Bot]

# v11.12.0
## (2022-10-14)

* Update balena/open-balena-base Docker tag to v13.6.0 [Renovate Bot]

# v11.11.10
## (2022-09-28)

* Update dependency @types/mocha to 10.0.0 [Renovate Bot]

# v11.11.9
## (2022-09-26)

* Update balena/open-balena-base Docker tag to v13.5.2 [Renovate Bot]

# v11.11.8
## (2022-09-26)

* Delete redundant .resinci.yml [Pagan Gazzard]

# v11.11.7
## (2022-09-15)

* Switch from balenaCI to flowzone [Pagan Gazzard]

# v11.11.6
## (2022-09-07)

* Stop automatic int parsing of openvpn events to avoid false positives [Pagan Gazzard]

# v11.11.5
## (2022-09-07)

* Set desired es-version for downstream modules that support it [Pagan Gazzard]

# v11.11.4
## (2022-09-02)

* Use a ref count rather than worker map for out of sync disconnects [Pagan Gazzard]

# v11.11.3
## (2022-09-01)

* Update dependencies [Pagan Gazzard]

# v11.11.2
## (2022-08-29)

* Avoid delays in client disconnection from affecting the draining cadence [Pagan Gazzard]

# v11.11.1
## (2022-08-22)

* Update balena/open-balena-base Docker tag to v13.5.1 [Renovate Bot]

# v11.11.0
## (2022-08-18)

* Update balena/open-balena-base Docker tag to v13.5.0 [Renovate Bot]

# v11.10.4
## (2022-08-15)

* Always send a connect event to the API if the connected worker changes [Pagan Gazzard]

# v11.10.3
## (2022-08-15)

* Use @balena/env-parsing for shared env var parsing behavior [Pagan Gazzard]

# v11.10.2
## (2022-08-15)

* Switch to conditionally calling husky install [Pagan Gazzard]

# v11.10.1
## (2022-08-11)

* Fix env var name [Pagan Gazzard]

# v11.10.0
## (2022-08-11)

* Allow specifying an internal hostname for balena-api comms [Pagan Gazzard]

# v11.9.8
## (2022-08-10)

* Fix Husky hooks not being installed on fresh repo clones [Pagan Gazzard]

# v11.9.7
## (2022-07-12)


<details>
<summary> Update open-balena-base to 13.4.0 [Pagan Gazzard] </summary>

> ## open-balena-base-13.4.0
> ### (2022-07-09)
> 
> * Update nodejs to 16.16.0 and npm to 8.13.2 [Pagan Gazzard]
> 
</details>

# v11.9.6
## (2022-07-11)

* Template systemd services [ab77]

# v11.9.5
## (2022-07-11)

* Switch to telnet-client 1.x to avoid memory leak [Pagan Gazzard]

# v11.9.4
## (2022-07-08)

* Use a rust binary rather than bash for handling openvpn auth [Pagan Gazzard]

# v11.9.3
## (2022-07-08)

* Avoid passing unnecessary arguments to the auth script [Pagan Gazzard]

# v11.9.2
## (2022-07-07)

* Update dependency husky to 8.0.1 [Renovate Bot]

# v11.9.1
## (2022-07-07)

* Reduce haproxy logging when verbose logging is disabled [Pagan Gazzard]

# v11.9.0
## (2022-07-07)

* Update dependency docker to 20 [Renovate Bot]

# v11.8.5
## (2022-07-07)

* Shard haproxy's VPN connection listener to the number of threads [Pagan Gazzard]

# v11.8.4
## (2022-07-05)

* correct HAProxy service TERM=>KILL flow [ab77]

# v11.8.3
## (2022-07-05)

* Emitted events should be in lowercase [Pagan Gazzard]

# v11.8.2
## (2022-07-04)

* Switch to using telnet-client directly [Pagan Gazzard]

# v11.8.1
## (2022-07-04)

* Fix docker cp paths for tests when re-running locally [Pagan Gazzard]

# v11.8.0
## (2022-07-04)

* Enable configuring of the `VPN_BYTECOUNT_INTERVAL` [Pagan Gazzard]

# v11.7.1
## (2022-07-04)

* Minor optimizations to the management stream parsing [Pagan Gazzard]

# v11.7.0
## (2022-07-04)

* Update to haproxy 2.6 [Pagan Gazzard]

# v11.6.4
## (2022-07-01)

* Use a plugin to run connect/disconnect scripts in the background [Pagan Gazzard]

# v11.6.3
## (2022-06-30)

* Handle uncaughtException(s) [ab77]

# v11.6.2
## (2022-06-30)

* Don't drain on unhandled exceptions [ab77]

# v11.6.1
## (2022-06-29)

* Revert "Handle client connect events asynchronously" [Page-]

# v11.6.0
## (2022-06-28)

* Update @sentry/node from 6.19.7 to 7.3.1 [Renovate Bot]

# v11.5.0
## (2022-06-28)

* Correct/refactor draining logic [ab77]

# v11.4.9
## (2022-06-28)

* Update dependencies [Pagan Gazzard]

# v11.4.8
## (2022-06-22)

* Update balena/open-balena-base from 13.3.1 to 13.3.2 [Renovate Bot]

# v11.4.7
## (2022-06-21)

* Remove superfluous process signaling [ab77]

# v11.4.6
## (2022-06-08)

* Handle client connect events asynchronously [Pagan Gazzard]

# v11.4.5
## (2022-06-07)

* Add an auth cache matching the API side cache [Pagan Gazzard]

# v11.4.4
## (2022-06-07)

* Standardize request timeout to 59s [Pagan Gazzard]

# v11.4.3
## (2022-05-25)

* Run the client connect/disconnect `curl`s in the background [Pagan Gazzard]

# v11.4.2
## (2022-05-25)

* Minimize time spent responding to openvpn scripts [Pagan Gazzard]

# v11.4.1
## (2022-05-20)

* Limit the VPN_INSTANCE_SUBNET_BITMASK to at most a /16 [Pagan Gazzard]

# v11.4.0
## (2022-05-20)

* Default to assigning the maximum possible subnet per openvpn process [Pagan Gazzard]

# v11.3.9
## (2022-05-20)

* Extract more config vars to their own module [Pagan Gazzard]

# v11.3.8
## (2022-05-18)

* Use await in all relevant places for async stack traces [Pagan Gazzard]

# v11.3.7
## (2022-05-18)

* Remove some unnecessary lodash usage [Pagan Gazzard]

# v11.3.6
## (2022-05-05)


<details>
<summary> Update open-balena-base to 13.3.1 [Pagan Gazzard] </summary>

> ## open-balena-base-13.3.1
> ### (2022-05-05)
> 
> * Add SystemMaxUse for journald.conf [Pagan Gazzard]
> 
</details>

# v11.3.5
## (2022-05-03)


<details>
<summary> Update open-balena-base to 13.3.0 [Pagan Gazzard] </summary>

> ## open-balena-base-13.3.0
> ### (2022-05-02)
> 
> * Update nodejs to 16.15.0 and npm to 8.8.0 [Pagan Gazzard]
> 
</details>

# v11.3.4
## (2022-04-28)

* Allow the client-connect/disconnect script to fail if necessary [Pagan Gazzard]

# v11.3.3
## (2022-04-25)

* Limit batching connectivity updates to avoid Payload Too Large errors [Thodoris Greasidis]

# v11.3.2
## (2022-04-25)

* Avoid passing an unnecessary `event` property from the openvpn scripts [Pagan Gazzard]
* Pass VPN_API_PORT into openvpn scripts to avoid the need to source env [Pagan Gazzard]
* Remove `CURL_EXTRA_FLAGS` concept since requests go to a local node now [Pagan Gazzard]

# v11.3.1
## (2022-04-25)

* Remove `BALENA_` prefix from `VPN_GATEWAY` env var [Pagan Gazzard]

# v11.3.0
## (2022-04-25)

* Use a plugin to handle auth asynchronously rather than synchronously [Pagan Gazzard]

# v11.2.7
## (2022-04-14)

* Use nodejs source map support rather than source-map-support module [Pagan Gazzard]

# v11.2.6
## (2022-04-14)


<details>
<summary> Update dependencies [Pagan Gazzard] </summary>

> ## node-metrics-gatherer-6.0.3
> ### (2022-04-07)
> 
> * Add an `aggregateRequestWorker` that must be called on cluster workers [Pagan Gazzard]
> 
> ## node-metrics-gatherer-6.0.2
> ### (2022-04-07)
> 
> * Use async/await for aggregateRequestHandler [Pagan Gazzard]
> 
> ## node-metrics-gatherer-6.0.1
> ### (2022-04-06)
> 
> * Add missing await [Josh Bowling]
> 
> ## node-metrics-gatherer-6.0.0
> ### (2022-04-05)
> 
> * Update prom-client to 14.x [Pagan Gazzard]
> 
> ## node-metrics-gatherer-5.7.6
> ### (2022-04-05)
> 
> * Update dependencies [Pagan Gazzard]
> 
> ## pinejs-client-request-7.3.5
> ### (2022-04-08)
> 
> 
> <details>
> <summary> Update dependencies [Pagan Gazzard] </summary>
> 
>> ### pinejs-client-js-6.10.2
>> #### (2022-04-08)
>> 
>> * Update dependencies [Pagan Gazzard]
>> * Remove circleci [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.10.1
>> #### (2022-02-08)
>> 
>> * Do not await the _request() result to allow enhanced promises downstream [Thodoris Greasidis]
>> 
> </details>
> 
> * Remove circleci [Pagan Gazzard]
> 
</details>

# v11.2.5
## (2022-04-08)

* Update open-balena-base to 13.2.1 Update open-balena-base from 13.2.1 to 13.2.3 [ab77]

# v11.2.4
## (2022-03-24)

* Use Sentry.withScope instead of Sentry.configureScope as it fits better [Pagan Gazzard]

# v11.2.3
## (2022-03-24)

* Update dependencies [Pagan Gazzard]

# v11.2.2
## (2022-03-22)

* CircleCI: Remove docker layer caching [Pagan Gazzard]

# v11.2.1
## (2022-03-21)


<details>
<summary> Update open-balena-base to 13.2.1 [Pagan Gazzard] </summary>

> ## open-balena-base-13.2.1
> ### (2022-03-21)
> 
> * Update nodejs to 16.14.2 and npm to 8.5.5 [Pagan Gazzard]
> 
</details>

# v11.2.0
## (2022-03-07)

* VPN connection draining [ab77]

# v11.1.0
## (2022-03-03)

* VPN connection draining [ab77]

# v11.0.2
## (2022-03-03)

* Add a 1s delay between batch reports to increase the chance of batching [Pagan Gazzard]

# v11.0.1
## (2022-03-01)

* Only try to report if there's at least one uuid changed [Pagan Gazzard]

# v11.0.0
## (2022-03-01)

* Report connecting/disconnecting clients in batches [Pagan Gazzard]

# v10.0.2
## (2022-03-01)

* Simplify logging of successful updates [Pagan Gazzard]

# v10.0.1
## (2022-02-28)

* Only compare the connected state when deciding if we need to report it [Pagan Gazzard]

# v10.0.0
## (2022-02-25)

* Stop sending virtual_address on connect events [Pagan Gazzard]

# v9.28.3
## (2022-02-25)

* Avoid passing unused data from openvpn connect scripts to nodejs [Pagan Gazzard]

# v9.28.2
## (2022-02-25)

* Ignore the worker id when deciding if we have a state change to report [Pagan Gazzard]

# v9.28.1
## (2022-02-25)

* Update dependencies [Pagan Gazzard]

# v9.28.0
## (2022-02-24)


<details>
<summary> Update open-balena-base to 13.2.0 [Pagan Gazzard] </summary>

> ## open-balena-base-13.2.0
> ### (2022-02-22)
> 
> * Consistent SENTRY environment names [ab77]
> 
</details>

# v9.27.2
## (2022-02-22)

* Avoid an issue with failing to mount namespaces [Pagan Gazzard]

# v9.27.1
## (2022-02-22)

* Remove `http-use-htx` option, it's now the default and only option [Pagan Gazzard]

# v9.27.0
## (2022-02-21)

* Update haproxy to 2.5 [Pagan Gazzard]

# v9.26.7
## (2022-02-21)


<details>
<summary> Update open-balena-base to 13.1.0 [Pagan Gazzard] </summary>

> ## open-balena-base-13.1.0
> ### (2022-02-21)
> 
> * Update nodejs to 16.14.0 and npm to 8.5.1 [Pagan Gazzard]
> 
> ## open-balena-base-13.0.7
> ### (2022-02-16)
> 
> * Avoid cryptic names and rename bcr to registry-proxy [Kyle Harding]
> 
> ## open-balena-base-13.0.6
> ### (2022-02-15)
> 
> * Add new balena container registry (bcr) host [Kyle Harding]
> 
> ## open-balena-base-13.0.5
> ### (2022-02-01)
> 
> * Refactor ROOT_CA handling/resolution [ab77]
> 
</details>

# v9.26.6
## (2022-01-20)

* Manually specify ulimit in haproxy.cfg [Pagan Gazzard]

# v9.26.5
## (2022-01-13)


<details>
<summary> Update open-balena-base to 13.0.4 [Pagan Gazzard] </summary>

> ## open-balena-base-13.0.4
> ### (2022-01-11)
> 
> * Update to nodejs 16.13.2 and npm 8.3.0 [Pagan Gazzard]
> 
</details>

# v9.26.4
## (2021-12-30)

* Use timers/promises instead of Bluebird.delay [Pagan Gazzard]

# v9.26.3
## (2021-12-24)

* Update dependencies [Pagan Gazzard]

# v9.26.2
## (2021-12-09)


<details>
<summary> Update open-balena-base to 13.0.3 [Pagan Gazzard] </summary>

> ## open-balena-base-13.0.3
> ### (2021-12-08)
> 
> * Update to nodejs 16.13.1 and npm 8.2.0 [Pagan Gazzard]
> 
> ## open-balena-base-13.0.2
> ### (2021-11-19)
> 
> * Stage stack global environment [ab77]
> 
> ## open-balena-base-13.0.1
> ### (2021-11-01)
> 
> * Install python3 for node-gyp 8.x which is used by npm 8 [Pagan Gazzard]
> 
</details>

# v9.26.1
## (2021-11-13)

* Raise soft open files limit for HAProxy [ab77]

# v9.26.0
## (2021-11-09)

* Allow ciphers to be configured [Pagan Gazzard]

# v9.25.1
## (2021-11-09)

* Add data-ciphers-fallback to allow older openvpn clients to connect [Pagan Gazzard]

# v9.25.0
## (2021-11-08)

* Enforce minimum TLS v1.2 [ab77]

# v9.24.0
## (2021-11-02)

* Add support for setting trust proxy via an env var [Pagan Gazzard]

# v9.23.1
## (2021-11-01)

* Update dependencies [Pagan Gazzard]

# v9.23.0
## (2021-11-01)


<details>
<summary> Update open-balena-base to 13.0.0 [Pagan Gazzard] </summary>

> ## open-balena-base-13.0.0
> ### (2021-10-30)
> 
> * Update nodejs to 16.13.0 and npm 8.1.1 [Pagan Gazzard]
> 
</details>

# v9.22.1
## (2021-10-18)


<details>
<summary> Update open-balena-base to 12.2.0 [Pagan Gazzard] </summary>

> ## open-balena-base-12.2.0
> ### (2021-10-18)
> 
> * Update nodejs to 14.18.1 and npm to 6.14.15 [Pagan Gazzard]
> 
> ## open-balena-base-12.1.1
> ### (2021-10-14)
> 
> * Simplify config by baking the device UUID into the DNS_TLD if available [Akis Kesoglou]
> * Fix configuration for non-BoB deployments [Akis Kesoglou]
> 
</details>

# v9.22.0
## (2021-09-24)


<details>
<summary> Update open-balena-base to 12.1.0 [ab77] </summary>

> ## open-balena-base-12.1.0
> ### (2021-09-24)
> 
> * Auto-configure balenaMachine(bob) [ab77]
> 
> ## open-balena-base-12.0.3
> ### (2021-09-01)
> 
> * Attempt to load root CA certificate bundle from file [ab77]
> 
</details>

# v9.21.2
## (2021-09-17)

* Fix losing the ip address to register when retrying on error [Pagan Gazzard]

# v9.21.1
## (2021-09-13)

* Update dependencies [Pagan Gazzard]

# v9.21.0
## (2021-08-25)

* Remove BALENA_|RESIN_ prefixes [ab77]

# v9.20.1
## (2021-08-24)


<details>
<summary> Update open-balena-base to 12.0.2 [Pagan Gazzard] </summary>

> ## open-balena-base-12.0.2
> ### (2021-08-24)
> 
> * Use multi-user.target as the default target [Pagan Gazzard]
> 
</details>

# v9.20.0
## (2021-08-24)

* Update node exporter to 1.2.2 [Pagan Gazzard]

# v9.19.0
## (2021-08-24)

* Update process exporter to 0.7.5 [Pagan Gazzard]

# v9.18.0
## (2021-08-20)


<details>
<summary> Update open-balena-base to 12.0.1 [Pagan Gazzard] </summary>

> ## open-balena-base-12.0.1
> ### (2021-08-19)
> 
> * Use basic.target as the default target [Pagan Gazzard]
> 
> ## open-balena-base-12.0.0
> ### (2021-08-17)
> 
> * Update to debian bullseye [Pagan Gazzard]
> 
</details>

# v9.17.19
## (2021-08-19)


<details>
<summary> Update open-balena-base to 11.3.12 [Pagan Gazzard] </summary>

> ## open-balena-base-11.3.12
> ### (2021-08-13)
> 
> * Add hosts [ab77]
> 
> ## open-balena-base-11.3.11
> ### (2021-08-13)
> 
> * Remove deprecated etcd config [ab77]
> 
> ## open-balena-base-11.3.10
> ### (2021-08-13)
> 
> * Add missing init script [ab77]
> 
</details>

# v9.17.18
## (2021-08-17)

* Update dependencies [Pagan Gazzard]

# v9.17.17
## (2021-08-13)


<details>
<summary> Update open-balena-base to 11.3.9 [Pagan Gazzard] </summary>

> ## open-balena-base-11.3.9
> ### (2021-08-13)
> 
> * Update no-systemd variant [ab77]
> 
</details>

# v9.17.16
## (2021-08-12)


<details>
<summary> Update open-balena-base to 11.3.8 [Pagan Gazzard] </summary>

> ## open-balena-base-11.3.8
> ### (2021-08-12)
> 
> * Update nodejs to 14.17.5 [Pagan Gazzard]
> 
> ## open-balena-base-11.3.7
> ### (2021-07-30)
> 
> * Use DNS_TLD internally [ab77]
> 
> ## open-balena-base-11.3.6
> ### (2021-07-30)
> 
> * Accept DNS_TLD in place of BALENA_TLD [ab77]
> 
</details>

# v9.17.15
## (2021-07-30)


<details>
<summary> Update open-balena-base to 11.3.5 [Pagan Gazzard] </summary>

> ## open-balena-base-11.3.5
> ### (2021-07-30)
> 
> * Update nodejs to 14.17.4 and npm to 6.14.14 [Pagan Gazzard]
> 
> ## open-balena-base-11.3.4
> ### (2021-07-30)
> 
> * Correct env var name and sort [ab77]
> 
</details>

# v9.17.14
## (2021-07-29)


<details>
<summary> Update open-balena-base to 11.3.3 [Pagan Gazzard] </summary>

> ## open-balena-base-11.3.3
> ### (2021-07-29)
> 
> * Add parallel HOSTs and env vars [ab77]
> 
</details>

# v9.17.13
## (2021-07-05)


<details>
<summary> Update open-balena-base to 11.3.2 [Pagan Gazzard] </summary>

> ## open-balena-base-11.3.2
> ### (2021-07-02)
> 
> * Update nodejs to 14.17.2 [Pagan Gazzard]
> 
> ## open-balena-base-11.3.1
> ### (2021-06-30)
> 
> * Delete .github directory [dfunckt]
> 
> ## open-balena-base-11.3.0
> ### (2021-06-30)
> 
> * Update nodejs to 14.17.1 [Trong Nghia Nguyen]
> 
</details>

# v9.17.12
## (2021-07-01)

* Delete CODEOWNERS [dfunckt]

# v9.17.11
## (2021-05-14)


<details>
<summary> Update open-balena-base to 11.2.0 [Pagan Gazzard] </summary>

> ## open-balena-base-11.2.0
> ### (2021-05-14)
> 
> * Update nodejs to 14.17.0 and npm to 6.14.13 [Pagan Gazzard]
> 
</details>

# v9.17.10
## (2021-04-09)


<details>
<summary> Update open-balena-base to 11.1.2 [Pagan Gazzard] </summary>

> ## open-balena-base-11.1.2
> ### (2021-04-08)
> 
> * Update nodejs to 14.16.1 and npm to 6.14.12 [Pagan Gazzard]
> 
> ## open-balena-base-11.1.1
> ### (2021-03-17)
> 
> * Drop CircleCI [ab77]
> 
</details>

# v9.17.9
## (2021-03-29)

* Remove linting on prepush as it's already handled on commit [Pagan Gazzard]

# v9.17.8
## (2021-03-29)

* Make more use of native promises and async/await [Pagan Gazzard]

# v9.17.7
## (2021-03-29)


<details>
<summary> Update dependencies [Pagan Gazzard] </summary>

> ## pinejs-client-request-7.3.1
> ### (2021-03-22)
> 
> 
> <details>
> <summary> Enable typescript strict mode [Pagan Gazzard] </summary>
> 
>> ### pinejs-client-js-6.9.5
>> #### (2021-03-22)
>> 
>> * Enable strict tsconfig options by default [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.9.4
>> #### (2021-03-10)
>> 
>> * Update dependencies [Pagan Gazzard]
>> 
> </details>
> 
> 
> ## pinejs-client-request-7.3.0
> ### (2020-11-20)
> 
> 
> <details>
> <summary> Update dependencies [Pagan Gazzard] </summary>
> 
>> ### pinejs-client-js-6.9.3
>> #### (2020-11-20)
>> 
>> * Explicitly specify return types for all functions [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.9.2
>> #### (2020-10-23)
>> 
>> * Update dev dependencies [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.9.1
>> #### (2020-09-17)
>> 
>> * Improve typings [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.9.0
>> #### (2020-09-07)
>> 
>> * Add 'getOrCreate' method supporting natural keys [Thodoris Greasidis]
>> 
>> ### pinejs-client-js-6.8.0
>> #### (2020-09-03)
>> 
>> * Add support for $format [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.7.3
>> #### (2020-08-26)
>> 
>> * Improve $orderby typing to allow `[{a: 'desc'}, {b: 'asc'}]` [Pagan Gazzard]
>> 
> </details>
> 
> 
</details>

# v9.17.6
## (2021-02-24)


<details>
<summary> Update open-balena-base to 11.1.0 [Pagan Gazzard] </summary>

> ## open-balena-base-11.1.0
> ### (2021-02-24)
> 
> * Update nodejs to 14.16.0 [Pagan Gazzard]
> 
</details>

# v9.17.5
## (2021-02-17)


<details>
<summary> Update open-balena-base to 11.0.5 [Pagan Gazzard] </summary>

> ## open-balena-base-11.0.5
> ### (2021-02-15)
> 
> * Update nodejs to 14.15.5 and npm to 6.14.11 [Pagan Gazzard]
> 
</details>

# v9.17.4
## (2021-01-13)


<details>
<summary> Update open-balena-base to 11.0.4 [Pagan Gazzard] </summary>

> ## open-balena-base-11.0.4
> ### (2021-01-08)
> 
> * Update nodejs to 14.15.4 and npm to 6.14.10 [Pagan Gazzard]
> 
</details>

# v9.17.3
## (2020-12-23)


<details>
<summary> Update open-balena-base to 11.0.3 [Pagan Gazzard] </summary>

> ## open-balena-base-11.0.3
> ### (2020-12-18)
> 
> * Update nodejs to 14.15.3 and npm to 6.14.9 [Pagan Gazzard]
> 
</details>

# v9.17.2
## (2020-11-20)


<details>
<summary> Update open-balena-base to 11.0.2 [Pagan Gazzard] </summary>

> ## open-balena-base-11.0.2
> ### (2020-11-18)
> 
> * Update nodejs to 14.15.1 [Pagan Gazzard]
> 
> ## open-balena-base-11.0.1
> ### (2020-10-29)
> 
> * Publish tagged versions of the no-systemd image [Pagan Gazzard]
> 
</details>

# v9.17.1
## (2020-10-28)

* meta: remove legacy codeowners [Matthew McGinn]

# v9.17.0
## (2020-10-28)


<details>
<summary> Update open-balena-base to 11.0.0 [Pagan Gazzard] </summary>

> ## open-balena-base-11.0.0
> ### (2020-10-27)
> 
> * Update to nodejs 14 [Pagan Gazzard]
> 
> ## open-balena-base-10.1.1
> ### (2020-10-09)
> 
> * Fix no-systemd nodejs version [Pagan Gazzard]
> 
</details>

# v9.16.6
## (2020-10-19)


<details>
<summary> Update open-balena-base to 10.1.0 [Pagan Gazzard] </summary>

> ## open-balena-base-10.1.0
> ### (2020-10-07)
> 
> * Update nodejs to 12.19.0 [Pagan Gazzard]
> 
</details>

# v9.16.5
## (2020-10-19)

* Fix string flattening [Pagan Gazzard]

# v9.16.4
## (2020-10-19)


<details>
<summary> Update dependencies [Pagan Gazzard] </summary>

> ## pinejs-client-request-7.2.2
> ### (2020-08-24)
> 
> * Update dev dependencies [Pagan Gazzard]
> 
</details>

# v9.16.3
## (2020-10-19)

* Avoid unintentionally keeping large strings in memory [Pagan Gazzard]

# v9.16.2
## (2020-10-16)

* Renew test certificates [ab77]

# v9.16.1
## (2020-09-17)

* update open-balena-base from 9.4.3 to 10.0.2 [Will Boyce]

# v9.16.0
## (2020-08-20)


<details>
<summary> Update dependencies [Pagan Gazzard] </summary>

> ## pinejs-client-request-7.2.1
> ### (2020-08-18)
> 
> 
> <details>
> <summary> Update dependencies [Pagan Gazzard] </summary>
> 
>> ### pinejs-client-js-6.7.1
>> #### (2020-08-12)
>> 
>> * Fix prepare $count typings [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.7.0
>> #### (2020-08-12)
>> 
>> * Improve typings for request/post/put/patch/delete [Pagan Gazzard]
>> 
> </details>
> 
> 
> ## pinejs-client-request-7.2.0
> ### (2020-08-12)
> 
> 
> <details>
> <summary> Update pinejs-client-core to 6.6.1 [Pagan Gazzard] </summary>
> 
>> ### typed-error-3.2.1
>> #### (2020-08-05)
>> 
>> * Update dependencies [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.6.1
>> #### (2020-08-11)
>> 
>> * Fix typing when id is specified to be `AnyObject | undefined` [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.6.0
>> #### (2020-08-11)
>> 
>> * Deprecate `$expand: { 'a/$count': {...} }` [Pagan Gazzard]
>> * Deprecate `resource: 'a/$count'` and update typings to reflect it [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.5.0
>> #### (2020-08-11)
>> 
>> * Add `options: { $count: { ... } }` sugar for top level $count [Pagan Gazzard]
>> * Add `$expand: { a: { $count: { ... } } }` sugar for $count in expands [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.4.0
>> #### (2020-08-11)
>> 
>> * Improve return typing of `subscribe` method [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.3.0
>> #### (2020-08-11)
>> 
>> * Fix Poll.on typings [Pagan Gazzard]
>> * Improve return typing when id is passed to GET methods [Pagan Gazzard]
>> * Remove `PromiseResult` type, use `Promise<PromiseResultTypes>` instead [Pagan Gazzard]
>> * Remove `PromiseObj` type, use `Promise<{}>` instead [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.2.0
>> #### (2020-08-10)
>> 
>> * Add `$filter: { a: { $count: 1 } }` sugar for $count in filters [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.1.2
>> #### (2020-08-10)
>> 
>> * Remove redundant ParamsObj/SubscribeParamsObj types [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.1.1
>> #### (2020-08-10)
>> 
>> * Make use of `mapObj` helper in more places [Pagan Gazzard]
>> * Use `Object.keys` in preference to `hasOwnProperty` where applicable [Pagan Gazzard]
>> 
> </details>
> 
> 
> ## pinejs-client-request-7.1.0
> ### (2020-07-28)
> 
> 
> <details>
> <summary> Update dependencies [Pagan Gazzard] </summary>
> 
>> ### pinejs-client-js-6.1.0
>> #### (2020-07-21)
>> 
>> * Add support for using named ids [Pagan Gazzard]
>> 
>> ### pinejs-client-js-6.0.1
>> #### (2020-06-19)
>> 
>> * Drop unnecessary async from request() [Thodoris Greasidis]
>> 
> </details>
> 
> 
> ## pinejs-client-request-7.0.1
> ### (2020-07-28)
> 
> * Increase default timeout to 59s [Pagan Gazzard]
> 
</details>

* Update to use api v6 [Pagan Gazzard]

# v9.15.0
## (2020-08-03)


<details>
<summary> Update to pinejs-client-request 7.x [Pagan Gazzard] </summary>

> ## pinejs-client-request-7.0.0
> ### (2020-06-16)
> 
> * Empty commit to attempt republish [Pagan Gazzard]
> * Switch from bluebird-lru-cache to lru-cache for caching [Pagan Gazzard]
> * Update target to es2018 [Pagan Gazzard]
> * Remove bluebird dependency [Pagan Gazzard]
> * Convert to async/await [Pagan Gazzard]
> 
> <details>
> <summary> Update to pinejs-client-core 6.x [Pagan Gazzard] </summary>
> 
>> ### pinejs-client-js-6.0.0
>> #### (2020-06-04)
>> 
>> * Increase minimum es version to es2015 [Pagan Gazzard]
>> * Convert to async/await [Pagan Gazzard]
>> * Remove now unnecessary PinejsClientCoreFactory [Pagan Gazzard]
>> * Switch to using native promises [Pagan Gazzard]
>> * Drop support for deprecated request overrides [Pagan Gazzard]
>> * Drop support for deprecated `query` method [Pagan Gazzard]
>> * Drop support for deprecated string based requests [Pagan Gazzard]
>> * Use `;` for expand options instead of `&` [Pagan Gazzard]
>> 
> </details>
> 
> 
> ## pinejs-client-request-6.2.0
> ### (2020-06-08)
> 
> * Lazy load bluebird-lru-cache and lodash [Pagan Gazzard]
> 
> ## pinejs-client-request-6.1.4
> ### (2020-06-08)
> 
> * Convert some lodash usage to native versions [Pagan Gazzard]
> 
> ## pinejs-client-request-6.1.3
> ### (2020-06-04)
> 
> * Remove unused dependencies [Pagan Gazzard]
> 
> ## pinejs-client-request-6.1.2
> ### (2020-06-02)
> 
> 
> <details>
> <summary> Update dependencies [Pagan Gazzard] </summary>
> 
>> ### pinejs-client-js-5.8.0
>> #### (2020-05-29)
>> 
>> * Generate optional builds for es2015/es2018 as well as the default es5 [Pagan Gazzard]
>> 
>> ### pinejs-client-js-5.7.1
>> #### (2020-05-25)
>> 
>> * Update dependencies [Pagan Gazzard]
>> 
>> ### pinejs-client-js-5.7.0
>> #### (2020-04-15)
>> 
>> * Make transformGetResult a method , to ease overriding the get method [Thodoris Greasidis]
>> 
> </details>
> 
> 
</details>

# v9.14.2
## (2020-07-29)


<details>
<summary> Update open-balena-base to 9.4.3 [Pagan Gazzard] </summary>

> ## open-balena-base-9.4.3
> ### (2020-07-24)
> 
> * Update nodejs to 12.18.3 and npm to 6.14.7 [Pagan Gazzard]
> 
</details>

# v9.14.1
## (2020-07-28)

* Increase UV_THREADPOOL_SIZE to 128 [Pagan Gazzard]

# v9.14.0
## (2020-07-14)

* register with api using local interface address if specified [Will Boyce]

# v9.13.7
## (2020-06-30)


<details>
<summary> Update open-balena-base to 9.4.2 [Pagan Gazzard] </summary>

> ## open-balena-base-9.4.2
> ### (2020-06-30)
> 
> * Update nodejs to 12.18.2 [Pagan Gazzard]

> ## open-balena-base-9.4.1
> ### (2020-06-19)
> 
> * Update nodejs to 12.18.1 [Pagan Gazzard]

> ## open-balena-base-9.4.0
> ### (2020-06-08)
> 
> * Update nodejs to 12.18.0 [Pagan Gazzard]
</details>

# v9.13.6
## (2020-06-05)

* dockerfile: explicitly disable os-provided openvpn services [Will Boyce]

# v9.13.5
## (2020-06-01)


<details>
<summary> Update open-balena-base to 9.3.0 [Pagan Gazzard] </summary>

> ## open-balena-base-9.3.0
> ### (2020-05-29)
> 
> * Update nodejs to 12.17.0 and npm to 6.14.5 [Pagan Gazzard]
</details>

# v9.13.4
## (2020-05-18)

* Update dependencies [Pagan Gazzard]

# v9.13.3
## (2020-05-01)


<details>
<summary> Update open-balena-base to 9.2.4 [Pagan Gazzard] </summary>

> ## open-balena-base-9.2.4
> ### (2020-04-30)
> 
> * Update nodejs to 12.16.3 [Pagan Gazzard]

> ## open-balena-base-9.2.3
> ### (2020-04-15)
> 
> * Forward log from journald to console by default [Trong Nghia Nguyen]
</details>

# v9.13.2
## (2020-04-22)

* refactor instance number autodetect [ab77]

# v9.13.1
## (2020-04-09)


<details>
<summary> Update open-balena-base to 9.2.2 [Pagan Gazzard] </summary>

> ## open-balena-base-9.2.2
> ### (2020-04-09)
> 
> * Update nodejs to 12.16.2, npm to 6.14.4 [Pagan Gazzard]
</details>

# v9.13.0
## (2020-04-08)

* resolve service instance count from podinfo [ab77]

<details>
<summary> update dependencies [Will Boyce] </summary>

> ## pinejs-client-request-6.1.1
> ### (2020-03-19)
> 
> * Add linting [Pagan Gazzard]

> ## pinejs-client-request-6.1.0
> ### (2020-03-19)
> 
> * Move require-npm4-to-publish to dev dependencies [Pagan Gazzard]
> 
<details>
<summary> Update dependencies [Pagan Gazzard] </summary>

>> ### typed-error-3.2.0
>> #### (2019-11-20)
>> 
>> * update deps and specify minimum engine requirements [Will Boyce]

>> ### pinejs-client-js-5.6.11
>> #### (2020-02-21)
>> 
>> * ðŸ›: Fix missing `deprecated.getStringParams` function [Andreas Fitzek]

>> ### pinejs-client-js-5.6.10
>> #### (2020-02-14)
>> 
>> * Update to resin-lint 3.x [Pagan Gazzard]

>> ### pinejs-client-js-5.6.9
>> #### (2020-02-14)
>> 
>> * CircleCI: Remove deploy job as it's handled by balenaCI [Pagan Gazzard]

>> ### pinejs-client-js-5.6.8
>> #### (2020-02-14)
>> 
>> * Add the missing `method` on the post method [Thodoris Greasidis]

>> ### pinejs-client-js-5.6.7
>> #### (2020-02-14)
>> 
>> * Deprecate request overrides [Pagan Gazzard]
>> * Deprecate queries using a string url [Pagan Gazzard]
>> * Deprecate `query` in favor of `get` [Pagan Gazzard]

>> ### pinejs-client-js-5.6.6
>> #### (2020-02-14)
>> 
>> * Allow resource/$count in $filter [Pagan Gazzard]

>> ### pinejs-client-js-5.6.5
>> #### (2020-01-30)
>> 
>> * Remove `defaults` helper in favour of `??` [Pagan Gazzard]

>> ### pinejs-client-js-5.6.4
>> #### (2020-01-30)
>> 
>> * Avoid allocations when destroying a poll [Pagan Gazzard]

>> ### pinejs-client-js-5.6.3
>> #### (2020-01-30)
>> 
>> * Improve `RawFilter` typing [Pagan Gazzard]

>> ### pinejs-client-js-5.6.2
>> #### (2020-01-29)
>> 
>> * Update dependencies [Pagan Gazzard]

>> ### pinejs-client-js-5.6.1
>> #### (2020-01-22)
>> 
>> * Switch most CODEOWNERS entries to a team [Pagan Gazzard]

>> ### pinejs-client-js-5.6.0
>> #### (2019-07-12)
>> 
>> * Add 'upsert' method supporting natural keys, requires Pinejs ^10.19.1 [Thodoris Greasidis]

>> ### pinejs-client-js-5.5.4
>> #### (2019-06-18)
>> 
>> * Remove unnecessary `string` type that is handled by the `Params` type [Pagan Gazzard]

>> ### pinejs-client-js-5.5.3
>> #### (2019-06-18)
>> 
>> * Use an .npmrc to prevent creating a package-lock on each install [Thodoris Greasidis]

>> ### pinejs-client-js-5.5.2
>> #### (2019-06-10)
>> 
>> * Add some type casting so that it compiles on TypeScript 3.5 [Thodoris Greasidis]

>> ### pinejs-client-js-5.5.1
>> #### (2019-05-15)
>> 
>> * Fix downstream declaration creation errors due to `Dictionary` [Pagan Gazzard]

>> ### pinejs-client-js-5.5.0
>> #### (2019-05-15)
>> 
>> * Add a prepare method that prepares a query into a function [Pagan Gazzard]

>> ### pinejs-client-js-5.4.1
>> #### (2019-05-10)
>> 
>> * Add CODEOWNERS [Gergely Imreh]

>> ### pinejs-client-js-5.4.0
>> #### (2019-05-10)
>> 
>> * Add support for parameter aliases in resource ids [Pagan Gazzard]

>> ### pinejs-client-js-5.3.10
>> #### (2019-05-10)
>> 
>> * Deduplicate transformation of GET results [Pagan Gazzard]

>> ### pinejs-client-js-5.3.9
>> #### (2019-05-10)
>> 
>> * Simplify how we expose types, which means `subscribe` is now exposed [Pagan Gazzard]

>> ### pinejs-client-js-5.3.8
>> #### (2019-05-09)
>> 
>> * Add automatic formatting via prettier [Pagan Gazzard]

>> ### pinejs-client-js-5.3.7
>> #### (2019-05-08)
>> 
>> * Remove node 4 build, add node 12 [Pagan Gazzard]
>> * Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]
</details>

> 

> ## pinejs-client-request-6.0.3
> ### (2020-01-22)
> 
> * Add CODEOWNERS [Pagan Gazzard]
</details>

# v9.12.4
## (2020-03-17)

* circleci: fix/optimise deploy to staging job [Will Boyce]

# v9.12.3
## (2020-03-17)

* circleci: fix deploy to staging job [Will Boyce]

# v9.12.2
## (2020-03-17)

* circleci: fix deploy to staging job [Will Boyce]

# v9.12.1
## (2020-03-17)

* circleci: update config to v2.1 syntax [Will Boyce]
* circleci: use `library/docker:19-git` image and enable layer caching [Will Boyce]

# v9.12.0
## (2020-03-12)

* proxy-worker: track a tunnel transmission errors metric [Will Boyce]
* nss: prioritise openvpn provider for dns lookups [Will Boyce]
* proxy-worker: improve device connection error handling [Will Boyce]
* utils: use `VPN_GUEST_API_KEY`, if provided, for anonymous queries [Will Boyce]
* proxy-worker: do not blindly attempt to forward requests on error [Will Boyce]
* proxy-worker: gracefully handle failed tunnelling request when possible [Will Boyce]

# v9.11.0
## (2020-03-04)

* add VPN_FORWARD_PROXY_PORT [ab77]

# v9.10.4
## (2020-02-20)


<details>
<summary> Update open-balena-base to 9.2.1 [Pagan Gazzard] </summary>

> ## open-balena-base-9.2.1
> ### (2020-02-20)
> 
> * Update nodejs to 12.16.1 [Pagan Gazzard]
</details>

# v9.10.3
## (2020-02-13)


<details>
<summary> Update open-balena-base to 9.2.0 [Pagan Gazzard] </summary>

> ## open-balena-base-9.2.0
> ### (2020-02-11)
> 
> * Update nodejs to 12.16.0 [Pagan Gazzard]

> ## open-balena-base-9.1.0
> ### (2020-02-06)
> 
> * Update nodejs to 12.15.0 and npm to 6.13.7 [Pagan Gazzard]
</details>

# v9.10.2
## (2020-02-03)

* Remove *.md from dockerignore so the changelog is included [Pagan Gazzard]

# v9.10.1
## (2020-01-25)


<details>
<summary> Update open-balena-base to 9.0.5 [Pagan Gazzard] </summary>

> ## open-balena-base-9.0.5
> ### (2020-01-10)
> 
> * Update nodejs to 12.14.1 and npm to 6.13.6 [Pagan Gazzard]

> ## open-balena-base-9.0.4
> ### (2020-01-07)
> 
> * Mask apt-daily-upgrade.timer [Pagan Gazzard]
</details>

# v9.10.0
## (2020-01-20)

* utils: cache `canAccess` lookups for 5s [Will Boyce]

# v9.9.0
## (2020-01-03)

* service: convert promise chains to async/await [Will Boyce]
* proxy-worker: convert promise chains to async/await [Will Boyce]

# v9.8.4
## (2019-12-24)


<details>
<summary> Update open-balena-base to 9.0.3 [Pagan Gazzard] </summary>

> ## open-balena-base-9.0.3
> ### (2019-12-24)
> 
> * Update nodejs to 12.14.0 and npm to 6.13.4 [Pagan Gazzard]

> ## open-balena-base-9.0.2
> ### (2019-12-20)
> 
> * Don't use UID used in node archive when unpacking as root [Federico Fissore]

> ## open-balena-base-9.0.1
> ### (2019-11-15)
> 
> * Update node to 12 in no systemd variant [Roman Mazur]
</details>

# v9.8.3
## (2019-11-18)

* vpn-worker: convert promise chains to async/await [Will Boyce]

# v9.8.2
## (2019-11-18)

* deps: update dependencies [Will Boyce]

# v9.8.1
## (2019-10-23)

* proxy: fix incorrect headers inserted into stream [Will Boyce]

# v9.8.0
## (2019-10-21)

* device-metrics: create timeseries per-device with device_uuid tag [Matthew McGinn]

# v9.7.0
## (2019-10-21)


<details>
<summary> Update open-balena-base to 9.0.0 [Pagan Gazzard] </summary>

> ## open-balena-base-9.0.0
> ### (2019-10-21)
> 
> * Update to nodejs 12 [Pagan Gazzard]

> ## open-balena-base-8.1.0
> ### (2019-09-24)
> 
> * Respect BALENA_TLD env variable in nosystemd variant [Roman Mazur]
> * Optimize for caching [Roman Mazur]
> * Use balena node base image [Roman Mazur]
> * Add a base image without systemd [Roman Mazur]
</details>

# v9.6.8
## (2019-10-15)

* Update dependencies [Pagan Gazzard]

# v9.6.7
## (2019-10-14)

* vpn: gracefully handle orphan server process refusing to die [Will Boyce]
* vpn: kill orphan server processes on startup [Will Boyce]

# v9.6.6
## (2019-10-11)

* Remove unused api keys [Pagan Gazzard]

# v9.6.5
## (2019-10-08)

* config: add switch for default verbose logging [Will Boyce]

# v9.6.4
## (2019-10-07)

* metrics: fix over-eager online count decrement [Will Boyce]
* api: fix typo in logger call [Will Boyce]

# v9.6.3
## (2019-10-07)

* metrics: always decrement online count on client-disconnect event [Will Boyce]
* api: increase verbosity of out-of-sync event reporting [Will Boyce]

# v9.6.2
## (2019-10-07)

* api: filter client state updates by worker id [Will Boyce]

# v9.6.1
## (2019-10-02)

* logging: include worker_id in state update messages [Will Boyce]

# v9.6.0
## (2019-10-01)

* logging: include openvpn pid in major events [Will Boyce]
* api: use single auth api server with shared pool [Will Boyce]

# v9.5.0
## (2019-09-30)

* proxy: refuse to forward tunnels via self and detect forwarding loops [Will Boyce]

# v9.4.1
## (2019-09-30)

* circleci: Rename deploy job [Michael Angelos Simos]

# v9.4.0
## (2019-09-27)

* logging: stream openvpn logs from process stdout/stderr [Will Boyce]
* logging: allow enabling openvpn verbose logging by default [Will Boyce]

# v9.3.1
## (2019-09-27)

* Remove redundant code [Pagan Gazzard]

# v9.3.0
## (2019-09-27)

* haproxy: disable checks on vpn workers [Will Boyce]

# v9.2.2
## (2019-09-23)

* npm: update dependencies [Will Boyce]
* npm: update dev dependencies [Will Boyce]

# v9.2.1
## (2019-09-16)

* CircleCI: Fix staging auto-deployments [Michael Angelos Simos]

# v9.2.0
## (2019-09-03)

* add `process-exporter` to collect stats on haproxy/node/openvpn [Will Boyce]
* haproxy: update to 2.0 & expose internal stats to prometheus [Will Boyce]
* add `node-exporter` to collect network statistics [Will Boyce]

# v9.1.0
## (2019-08-29)

* haproxy: remove proxy process metrics config [Will Boyce]

# v9.0.0
## (2019-08-27)

* proxy: prevent forwarding request to self [Will Boyce]
* refactor: merge systemd services [Will Boyce]

# v8.20.4
## (2019-08-20)


<details>
<summary> Update open-balena-base to 8.0.3 [Pagan Gazzard] </summary>

> ## open-balena-base-8.0.3
> ### (2019-08-16)
> 
> * ðŸ”’: Update Node to 10.16.3 and NPM to 6.10.3 [Andreas Fitzek]
</details>

# v8.20.3
## (2019-08-13)

* Change syslog identifier from 'open-balena' to 'vpn' [Pagan Gazzard]
* Reduce log length for proxying messages [Pagan Gazzard]

# v8.20.2
## (2019-08-06)


<details>
<summary> Update open-balena-base to 8.0.2 [Pagan Gazzard] </summary>

> ## open-balena-base-8.0.2
> ### (2019-08-06)
> 
> * Update nodejs to 10.16.1 and npm to 6.10.2 [Pagan Gazzard]
</details>

# v8.20.1
## (2019-08-01)

* service: Ensure captureException does not throw [Heds Simons]

# v8.20.0
## (2019-07-30)

* Combine the worker id into the service name [Pagan Gazzard]

# v8.19.1
## (2019-07-22)

* haproxy: restore logs and fix timeout configs [Will Boyce]

# v8.19.0
## (2019-07-22)

* vpn-api: enable openvpn logging via management console [Will Boyce]
* openvpn: set txqueuelen=1000 on interfaces at startup [Will Boyce]

# v8.18.0
## (2019-07-20)

* vpn-api: reduce default log verbosity [Will Boyce]

# v8.17.4
## (2019-07-19)

* openvpn: Remove override files for service [Heds Simons]

# v8.17.3
## (2019-07-18)

* config: fix typo in env template [Will Boyce]

# v8.17.2
## (2019-07-17)


<details>
<summary> Update open-balena-base to 8.0.1 [Pagan Gazzard] </summary>

> ## open-balena-base-8.0.1
> ### (2019-07-17)
> 
> * mdns: Ensure multipart subdomains are allowed [Heds Simons]
</details>

# v8.17.1
## (2019-07-16)

* replace deprecated raven package with @sentry/node [Will Boyce]

# v8.17.0
## (2019-07-16)

* dev: fix unit test mocks [Will Boyce]
* deps: update dependencies [Will Boyce]
* config: allow overriding `VPN_INSTANCE_COUNT` [Will Boyce]
* metrics: fix up metrics naming [Matthew McGinn]

# v8.16.1
## (2019-07-15)

* systemd: move StartLimitIntervalSec to proper section [Matthew McGinn]

# v8.16.0
## (2019-07-15)


<details>
<summary> Update open-balena-base to 8.0.0 [Pagan Gazzard] </summary>

> ## open-balena-base-8.0.0
> ### (2019-07-08)
> 
> * Upgrade to debian buster [Pagan Gazzard]
</details>

# v8.15.2
## (2019-07-05)

* Use a prepared query for `canAccessDevice` [Pagan Gazzard]
* Use a prepared query for getDeviceByUUID [Pagan Gazzard]

# v8.15.1
## (2019-06-25)

* Only try to forward to the correct vpn instance if lookup fails [Pagan Gazzard]

# v8.15.0
## (2019-06-24)

* subnets: add config opts for vpn subnets and default to RFC6598 block [Will Boyce]

# v8.14.2
## (2019-06-24)

* circle: fix deploy to staging job [Will Boyce]

# v8.14.1
## (2019-06-24)

* deps: update dependencies [Will Boyce]

<details>
<summary> View details </summary>

## pinejs-client-request-6.0.2
### (2019-05-08)

* Add node 12 tests [Pagan Gazzard]
* Add upstream for pinejs-client-core [Pagan Gazzard]
</details>

* dockerfile: remove extraneous apt-get installs [Will Boyce]
* tests: fix canAccess mocks to account for tunnel-any perms [Will Boyce]
* tests: kill openvpn process when complete to prevent hanging [Will Boyce]
* dev: configure circle to test prs and deploy new versions to staging [Will Boyce]

# v8.14.0
## (2019-06-22)

* dev: move typescript+@types dependencies to devDependencies [Will Boyce]

# v8.13.3
## (2019-06-20)

* Update open-balena-base to 7.2.2 [Pagan Gazzard]

<details>
<summary> View details </summary>

## open-balena-base-7.2.2
### (2019-06-19)

* systemd: move StartLimitIntervalSec to proper conf section [Matthew McGinn]
</details>

# v8.13.2
## (2019-06-06)

* Update open-balena-base to 7.2.1 [Pagan Gazzard]

<details>
<summary> View details </summary>

## open-balena-base-7.2.1
### (2019-06-03)

* Fix adding htoprc [Pagan Gazzard]
</details>

# v8.13.1
## (2019-06-04)

* perms: Add tunnel-any check when tunnelling ports [Rich Bayliss]

# v8.13.0
## (2019-05-29)

* Update open-balena-base to 7.2.0 [Pagan Gazzard]

<details>
<summary> View details </summary>

## open-balena-base-7.2.0
### (2019-05-29)

* Add default htop settings to hide threads and use a tree view [Pagan Gazzard]

## open-balena-base-7.1.0
### (2019-05-29)

* Update nodejs to 10.16.0 and npm to 6.9.0 [Pagan Gazzard]
</details>

# v8.12.4
## (2019-05-08)

* Disable the service start limits [Pagan Gazzard]
* Update open-balena-base to 7.0.2 [Pagan Gazzard]

<details>
<summary> View details </summary>

## open-balena-base-7.0.2
### (2019-05-06)

* Disable the apt daily timer [Pagan Gazzard]

## open-balena-base-7.0.1
### (2019-05-06)

* Disable start limit for confd.service [Pagan Gazzard]
</details>

# v8.12.3
## (2019-04-24)

* vpn: use pooled request workers for client authentication via api [Will Boyce]

# v8.12.2
## (2019-04-24)

* metrics: increase granularity of bitrate buckets [Will Boyce]

# v8.12.1
## (2019-04-24)

* pinejs-client-request: update to v6.0.1 [Will Boyce]

<details>
<summary> View details </summary>

## pinejs-client-request-6.0.1
### (2019-04-23)

* Update target to es2016, part of/fixing the typed-error bump [Pagan Gazzard]
</details>

# v8.12.0
## (2019-04-23)

* vpn: revert to script/curl/api based client auth [Will Boyce]
* pinejs-client-request: update to v6.0.0 [Will Boyce]

<details>
<summary> View details </summary>

## pinejs-client-request-6.0.0
### (2019-04-17)

* typed-error: Update to v3.1.0 [Will Boyce]

## pinejs-client-request-5.2.0
### (2019-02-12)

* Export the StatusError from module [Cameron Diver]
</details>

* node-tunnel: update to v3.0.0 [Will Boyce]

<details>
<summary> View details </summary>

## node-tunnel-3.0.0
### (2019-04-17)

* Switch to `eventemitter3.EventEmitter` from the stdlib EventEmitter [Will Boyce]
</details>

* vpn: switch to eventemitter3 in openvpn management class- [Will Boyce]

# v8.11.3
## (2019-04-19)

* vpn: guard against writing bandwidth metrics for unknown clients [Will Boyce]

# v8.11.2
## (2019-04-19)

* metrics: reduce cardinality of session bitrate metrics [Will Boyce]

# v8.11.1
## (2019-04-16)

* openvpn: discard process output [Will Boyce]
* haproxy: log backend events [Will Boyce]

# v8.11.0
## (2019-04-16)

* proxy: collect tunnel count stats for prometheus [Will Boyce]
* logging: unify logging formats and practices [Will Boyce]
* vpn: use management interface to manage openvpn processes [Will Boyce]

## 8.10.3 - 2019-04-15

* Versionist: set repo type to docker [Will Boyce]

## 8.10.2 - 2019-04-15

* versionbot: add structured CHANGELOG.yml [Will Boyce]

## 8.10.1 - 2019-04-01

* connect-proxy: Only query API for online devices [Will Boyce]
* connect-proxy: Reduce log verbosity [Will Boyce]
* npm: Update dependencies [Will Boyce]

## 8.10.0 - 2019-03-14

* Open-balena-base: Update open-balena-base to v7.0.0 [Heds Simons]

## 8.9.0 - 2019-03-12

* Open-balena-base: Update open-balena-base to v6.0.0 [Heds Simons]

## 8.8.1 - 2019-03-08

* Codeowners: Update with	@Page- & @hedss [Heds Simons]

## 8.8.0 - 2019-03-08

* Core: Add sourcemap support when running javascript [Will Boyce]
* Core: Update dependencies [Will Boyce]
* Core: Update typescript and @types [Will Boyce]
* Core: Update dev dependencies [Will Boyce]
* Openvpn: Reduce log verbosity [Will Boyce]

## 8.7.0 - 2019-03-05

* Update open-balena-base to v5.3.1 [Pagan Gazzard]

## 8.6.0 - 2019-02-28

* Vpn-api: set FORWARD chain policy on startup [Will Boyce]

## 8.5.0 - 2019-02-20

* Switch to a https.Agent instance for limiting concurrent requests [Pagan Gazzard]

## 8.4.0 - 2018-12-18

* Core: Run unit tests when building docker image [Will Boyce]
* Core: Update npm dependencies [Will Boyce]
* Core: Precompile typescript and run javascript in production [Will Boyce]

## 8.3.1 - 2018-12-03

* Update open-balena-base to v5.0.1 [Pagan Gazzard]

## 8.3.0 - 2018-11-22

* Connect-proxy: Improve error handling [Will Boyce]
* Connect-proxy: Route non local requests via the relevant instance [Will Boyce]
* Lint: Auto-prettify staged changes using husky/lint-staged [Will Boyce]

## 8.2.1 - 2018-11-06

* Api: Remove references to `is_web_accessible` device attr [Will Boyce]

## v8.2.0 - 2018-10-30

* Logging: Fix a few incomplete log messages [Will Boyce]
* Lint: Enforce `prettier` coding standards [Will Boyce]
* Api: Use balenaAPI v5 endpoint [Will Boyce]
* Rename: Tidy up some remaining resin references [Will Boyce]
* Core: Update npm dependencies [Will Boyce]
* Open-sourcing: Prepare for open-sourcing repository [Will Boyce]

## v8.1.0 - 2018-10-30

* Update to open-balena-base 5.0.0, including nodejs 10 [Pagan Gazzard]
* Rename: Rename remaining `RESIN_` variables to `BALENA_` [Will Boyce]

## v8.0.2 - 2018-10-25

* Base: Update resin-base version to autoset subdomain envvars [Heds Simons]

## v8.0.1 - 2018-10-23

* Dockerfile: Use `balena/open-balena-base` base image [Will Boyce]

## v8.0.0 - 2018-10-22

* Open-balena: Remove CircleCI config [Will Boyce]
* Open-balena: Remove analytics scripts [Will Boyce]
* Open-balena: Rename services, scripts, etc [Will Boyce]

## v7.7.0 - 2018-10-19

* Confd: Fix confd env var naming [Will Boyce]

## v7.6.2 - 2018-10-18

* Logging: Configure winston log transports [Will Boyce]

## v7.6.1 - 2018-10-18

* Api: Pass authorisation details using headers, not querystring [Will Boyce]

## v7.6.0 - 2018-10-18

* Connect-proxy: Send logs to console (and journal) [Will Boyce]

## v7.5.0 - 2018-10-16

* Config: Move openvpn secrets (certs, etc) from repo (into confd) [Will Boyce]

## v7.4.1 - 2018-10-16

* Disable express' x-powered-by header [Pagan Gazzard]

## v7.4.0 - 2018-10-10

* Connect-proxy: Use canAccess endpoint to authenticate tunnel requests [Will Boyce]

## v7.3.4 - 2018-10-08

* Deps: Update node-tunnel to 2.x [Will Boyce]

## v7.3.3 - 2018-10-08

* Connect-proxy: Authenticate API service using API or VPN keys [Will Boyce]

## v7.3.2 - 2018-10-02

* Service: Fix `wrap` function not sending heartbeats [Will Boyce]

## v7.3.1 - 2018-09-28

* Dns: Ensure DNS is prioritised over MDNS [Heds Simons]

## v7.3.0 - 2018-09-24

* Logging: Enable logging output to also go to console [Heds Simons]

## v7.2.0 - 2018-09-13

* Update to resin-base 4.3.0 [Pagan Gazzard]

## v7.1.2 - 2018-09-04

* Circleci: Only deploy to staging when committer is "Resin CI" [Will Boyce]

## v7.1.1 - 2018-09-04

* Bluebird: Update to 3.5.2 which includes memory fix [Will Boyce]

## v7.1.0 - 2018-09-04

* Add AGPL 3.0 LICENSE and preamble/headers [Will Boyce]

## v7.0.5 - 2018-08-31

* Add .resinci.yml [Jack Brown]

## v7.0.4 - 2018-08-28

* Update mocha #133 [Pagan Gazzard]

## v7.0.3 - 2018-08-24

* Update to pinejs-client 5.x #132 [Pagan Gazzard]
* Update to typescript 3 #132 [Pagan Gazzard]

## v7.0.2 - 2018-08-20

* Run typescript validation as part of the build #129 [Will Boyce]

## v7.0.1 - 2018-08-07

* Remove usage of (leaky) `Raven.requestHandler` #123 [Will Boyce]

## v7.0.0 - 2018-08-06

* Convert remaining coffee src + tests to typescript #92 [Will Boyce]

## v6.3.1 - 2018-07-05

* Move to latest version of `resin-base` to include MDNS support. #121 [Heds Simons]

## v6.3.0 - 2018-06-08

* Remove haproxy-specific rsyslog configuration #119 [Will Boyce]

## v6.2.1 - 2018-04-19

* Sync confd env backend configuration #117 [Michael Angelos Simos]

## v6.2.0 - 2018-04-12

* Add confd envvar backend configuration. #105 [Michael Angelos Simos]

## v6.1.1 - 2018-04-12

* Move to using `balena-root-ca.service` unit file in `resin-base` to handle self-signed CAs. #111 [Heds Simons]

## v6.1.0 - 2018-04-02

* Use resin-api v4 endpoints #109 [Will Boyce]

## v6.0.1 - 2018-03-27

* Expose addition healthcheck service accepting PROXY #108 [Will Boyce]

## v6.0.0 - 2018-03-27

* Update haproxy PROXY configuration (default: false) #106 [Will Boyce]

## v5.2.1 - 2018-03-23

* Further haproxy config updates + opimisations #107 [Will Boyce]

## v5.2.0 - 2018-03-22

* Update haproxy and optimise configuration #103 [Will Boyce]

## v5.1.1 - 2018-03-21

* Update libnss-openvpn fixing file descriptor leak #102 [Will Boyce]

## v5.1.0 - 2018-03-20

* Update base image to `resin-base:v3.3.0` #100 [Will Boyce]

## v5.0.0 - 2018-03-12

* Accept ProxyProtocol in haproxy and log IP mappings #95 [Will Boyce]

## v4.0.4 - 2018-03-06

* Suppress openvpn timestamps (as to avoid duplicates) #94 [Will Boyce]

## v4.0.3 - 2018-03-06

* Explicitly set `compress` algorithm to `lzo` #93 [Will Boyce]

## v4.0.2 - 2018-03-05

* Remove deprecated options from openvpn config #88 [Will Boyce]

## v4.0.1 - 2018-02-21

* Improve netmask splitting and related tests #91 [Will Boyce]

## v4.0.0 - 2018-02-20

* Vertical scaling of resin-vpn and openvpn services #40 [Will Boyce]

## v3.4.3 - 2018-02-14

* Report version on startup (and fix sentry release tracking) #90 [Will Boyce]

## v3.4.2 - 2018-02-08

* Log device state when successfully updated #86 [Will Boyce]

## v3.4.1 - 2018-02-06

* Allow override of OpenVPN keepalive values via env #84 [Will Boyce]

## v3.4.0 - 2018-01-12

* Update OpenVPN (2.4) and OpenSSL (1.0.2) #82 [Will Boyce]

## v3.3.0 - 2017-12-15

* Use clustering in connect proxy #79 [Will Boyce]

## v3.2.0 - 2017-12-15

* Rewrite connect proxy in typescript and update node-tunnel #77 [Will Boyce]

## v3.1.0 - 2017-12-15

* Log uuid of device when auth fails #78 [Will Boyce]

## v3.0.10 - 2017-12-14

* Use `typed-error` for custom Error classes #75 [Will Boyce]

## v3.0.9 - 2017-12-13

* Avoid flooding API with requests when many devices (dis)connect #73 [John (Jack) Brown]

## v3.0.8 - 2017-12-12

* Auto-deploy master branch builds to staging #72 [Will Boyce]

## v3.0.7 - 2017-11-29

* Add ability to use trusted self-signed root CAs in the VPN service, for the OnPrem solution. #66 [Heds Simons]

## v3.0.6 - 2017-11-27

* Do not report `HandledTunnelingError` to Sentry #70 [Will Boyce]

## v3.0.5 - 2017-11-21

* Rotate openvpn keys; add Makefile for key management #67 [John (Jack) Brown]

## v3.0.4 - 2017-10-31

* Update base image to `resin-base:v2.9.2` #63 [Will Boyce]

## v3.0.3 - 2017-10-23

* Update to pinejs-client ^4.2.3 #62 [Pagan Gazzard]

## v3.0.2 - 2017-10-17

* Simplify errors.ts #60 [Pagan Gazzard]

## v3.0.1 - 2017-10-17

* `captureException` should use pre-configured `Raven` #58 [Will Boyce]
* Add tslint and fix lint errors #58 [Will Boyce]

## v3.0.0 - 2017-10-10

* Remove GET /api/v1/clients endpoint #54 [Will Boyce]

## v2.1.1 - 2017-10-10

* Report errors to sentry #38 [Will Boyce]

## v2.1.0 - 2017-10-06

* Start the typescript conversion; convert src/libs/post-pool to typescript #57 [Pagan Gazzard]

## v2.0.4 - 2017-09-04

* Add `Restart=always` directive to openvpn@.service #51 [Will Boyce]
* Set "max locked memory" limit to unlimited for openvpn service #51 [Will Boyce]

## v2.0.3 - 2017-08-03

* Remove jenkins scripts [Will Boyce]

## v2.0.2 - 2017-07-19

* Update `resin-lint` and fix lint errors [Will Boyce]

## v2.0.1 - 2017-06-30

* Add PR template [Kostas Lekkas]

## v2.0.0 - 2017-05-29

* Pull device information from the API using the v2 endpoint [Ariel Flesler]
* Remove reset-all, register service on API, include service ID on connect & disconnect requests [Ariel Flesler]

## v1.3.2 - 2017-05-25

* Add circle ci config [Will Boyce]

## v1.3.1 - 2017-05-16

* Lint the code only on prepush hook, before running the tests [Ariel Flesler]

## v1.3.0 - 2017-05-16

* Change base image to resin-base:2, remove resin-jwt dependency and use api key-based authentication [Kostas Lekkas]

## v1.2.1 - 2017-05-16

* Hotfix: resolve promise chain before recursing [Petros Angelatos]

## v1.2.0 - 2017-05-15

* Update openvpn config [Will Boyce]

## v1.1.2 - 2017-05-10

* Add a Promise.timeout for connect/disconnect events [Pagan Gazzard]

## v1.1.1 - 2017-04-07

* Implement linting on precommit and fast tests on prepush [Ariel Flesler]

## v1.1.0 - 2017-03-21

* Revert "apply fix for small sndbuf/rcvbuf in openvpn" [Will Boyce]
* Apply fix for small sndbuf/rcvbuf in openvpn [Will Boyce]

## v1.0.0 - 2017-02-23

* Changed the queuing logic so that it is per device, and will only send the latest state. [Internal] [Page]
* Removed reset-all when updating device state fails, just retry until it succeeds. [Internal] [Page]
* Fixed a `TypeError: Cannot read property 'statusCode' of undefined` error. [Internal] [Page]

# 2016-10-10

* Defined timeouts on all requests, to help with hung connections. [Internal] [Page]
* Decreased amount of times to retry a request, so it doesn't retry essentially forever. [Internal] [Page]
* Increased max clients to 32768 [Internal] [Page]

# 2016-06-28

* Fix unused and undefined variables [Internal] [Kostas]
* Added bw_by_user.sh script for calculating the bandwidth used by user's devices on VPN [Internal] [Praneeth]

# 2016-06-01

* Update to node-tunnel@0.2.2 - Fix eternal FIN-WAIT-2 by dropping support for half-closed connections [External][Kostas]
* Improved tunneling error logging [Internal] [Kostas]

# 2016-05-11

* Use forked libnss-openvpn to fix leaked file descriptors. [Internal] [Aleksis]

# 2016-04-27

* Whitelist device port 22222 for proxy api key [External] [Kostas]
* Remove legacy activePort so that resin-vpn can safely be restarted. [Internal] [Aleksis]
* Use resin-lint [Internal] [Kostas]
* Remove device port 4200 from web access whitelist [External] [Kostas]
* Updated dependencies [Internal] [Page]
* Reduce noise in logs [Internal] [Kostas]
* Always restart resin-vpn.service if process exits or is killed. [Internal] [Kostas]

# 2016-01-20

* Wait a while after starting VPN to do the reset-all, to reduce the number of devices that appear offline during the mass reconnect. [Internal] [Page]
* Fixed client events http status code check. [Internal] [Aleksis]
* Update pinejs-client to include the escaping fix. [Internal] [Page]
* Updated to the new resin-base. [Internal] [Page]

# 2015-01-05

* Use the uuid to connect to the device, rather than relying on the api reported vpn_address which may be incorrect. [Internal] [Page]

# 2015-12-01

* Updated the vpn server certificate for another two years, to `Nov 23 16:10:32 2017 GMT` [Internal] [Page]
* Switched to a purely etcd backed confd. [Internal] [Page]
* Updated resin-base to include nodejs v4. [Internal] [Page]
* Removed reverse-proxy as it's going to continue living in resin-proxy with fixes. [Internal] [Page]

# 2015-11-12

* Allow connecting to devices via uuid rather than ip, using `${uuid}.vpn` [Internal] [Page]
* Fix the grammar of the proxy error pages. [Page]

# 2015-10-01

* Added winston logging module and improved logging on tunnel requests.
* Fixed an rsyslogd infinite restart loop when there is no logentries token. [Page]

# 2015-08-17

* Use JWT to authenticate requests from the API. [Aleksis]
* Try to populate the docker cache before building. [Page]
* Switched to using a tagged version of resin-base. [Page]

# 2015-07-26

* Added a /ping endpoint. [Aleksis]
* Switched to http/1.0 for the reverse proxy - necessary for some nc versions (eg OSX). [Aleksis]
* Always used the short commit hash for tagging. [Petros]
* Improved test script. [Aleksis]
* Switched logentries to TLS. [Petros]
* Switched to using some published modules. [Aleksis]
* Added VPN reverse proxy. [Aleksis]
* Report additional data on auth fail. [Lorenzo]

# 2015-07-17

* Changed to support newer resin-base with confd 0.10.0 [Page]
* Added VPN proxy. [Aleksis]
* Cleaned up openvpn-nc. [Aleksis]
* Disable autogeneration of openvpn services. [Petros]

# 2015-06-10

* Fix reset-all error handler [Aleksis]
* Fix VPN race condition causing incorrect online/offline state [petrosagg]
* Use less aggressive keepalive settings [petrosagg]

# 2015-05-13

v0.1.1
* Request API to reset all clients state when VPN starts and on event message failure. [Aleksis]
* Fix race condition of /dev/net/tun device node creation [petrosagg]
* Fix typo in client authentication [Page]

v0.1.0
* Switched to using resin-base. [Aleksis]
* Improved tests and made them able to be run by jenkins. [Aleksis]
