# Change Log

All notable changes to this project will be documented in this file
automatically by Versionist. DO NOT EDIT THIS FILE MANUALLY!
This project adheres to [Semantic Versioning](http://semver.org/).

## 8.5.0 - 2019-02-20

* Switch to a https.Agent instance for limiting concurrent requests [Pagan Gazzard]

## 8.4.0 - 2018-12-18

* Core: Run unit tests when building docker image [Will Boyce]
* Core: Update npm dependencies [Will Boyce]
* Core: Precompile typescript and run javascript in production [Will Boyce]

## 8.3.1 - 2018-12-03

* Update open-balena-base to v5.0.1 [Pagan Gazzard]

## 8.3.0 - 2018-11-22

* Connect-proxy: Improve error handling [Will Boyce]
* Connect-proxy: Route non local requests via the relevant instance [Will Boyce]
* Lint: Auto-prettify staged changes using husky/lint-staged [Will Boyce]

## 8.2.1 - 2018-11-06

* Api: Remove references to `is_web_accessible` device attr [Will Boyce]

## v8.2.0 - 2018-10-30

* Logging: Fix a few incomplete log messages [Will Boyce]
* Lint: Enforce `prettier` coding standards [Will Boyce]
* Api: Use balenaAPI v5 endpoint [Will Boyce]
* Rename: Tidy up some remaining resin references [Will Boyce]
* Core: Update npm dependencies [Will Boyce]
* Open-sourcing: Prepare for open-sourcing repository [Will Boyce]

## v8.1.0 - 2018-10-30

* Update to open-balena-base 5.0.0, including nodejs 10 [Pagan Gazzard]
* Rename: Rename remaining `RESIN_` variables to `BALENA_` [Will Boyce]

## v8.0.2 - 2018-10-25

* Base: Update resin-base version to autoset subdomain envvars [Heds Simons]

## v8.0.1 - 2018-10-23

* Dockerfile: Use `balena/open-balena-base` base image [Will Boyce]

## v8.0.0 - 2018-10-22

* Open-balena: Remove CircleCI config [Will Boyce]
* Open-balena: Remove analytics scripts [Will Boyce]
* Open-balena: Rename services, scripts, etc [Will Boyce]

## v7.7.0 - 2018-10-19

* Confd: Fix confd env var naming [Will Boyce]

## v7.6.2 - 2018-10-18

* Logging: Configure winston log transports [Will Boyce]

## v7.6.1 - 2018-10-18

* Api: Pass authorisation details using headers, not querystring [Will Boyce]

## v7.6.0 - 2018-10-18

* Connect-proxy: Send logs to console (and journal) [Will Boyce]

## v7.5.0 - 2018-10-16

* Config: Move openvpn secrets (certs, etc) from repo (into confd) [Will Boyce]

## v7.4.1 - 2018-10-16

* Disable express' x-powered-by header [Pagan Gazzard]

## v7.4.0 - 2018-10-10

* Connect-proxy: Use canAccess endpoint to authenticate tunnel requests [Will Boyce]

## v7.3.4 - 2018-10-08

* Deps: Update node-tunnel to 2.x [Will Boyce]

## v7.3.3 - 2018-10-08

* Connect-proxy: Authenticate API service using API or VPN keys [Will Boyce]

## v7.3.2 - 2018-10-02

* Service: Fix `wrap` function not sending heartbeats [Will Boyce]

## v7.3.1 - 2018-09-28

* Dns: Ensure DNS is prioritised over MDNS [Heds Simons]

## v7.3.0 - 2018-09-24

* Logging: Enable logging output to also go to console [Heds Simons]

## v7.2.0 - 2018-09-13

* Update to resin-base 4.3.0 [Pagan Gazzard]

## v7.1.2 - 2018-09-04

* Circleci: Only deploy to staging when committer is "Resin CI" [Will Boyce]

## v7.1.1 - 2018-09-04

* Bluebird: Update to 3.5.2 which includes memory fix [Will Boyce]

## v7.1.0 - 2018-09-04

* Add AGPL 3.0 LICENSE and preamble/headers [Will Boyce]

## v7.0.5 - 2018-08-31

* Add .resinci.yml [Jack Brown]

## v7.0.4 - 2018-08-28

* Update mocha #133 [Pagan Gazzard]

## v7.0.3 - 2018-08-24

* Update to pinejs-client 5.x #132 [Pagan Gazzard]
* Update to typescript 3 #132 [Pagan Gazzard]

## v7.0.2 - 2018-08-20

* Run typescript validation as part of the build #129 [Will Boyce]

## v7.0.1 - 2018-08-07

* Remove usage of (leaky) `Raven.requestHandler` #123 [Will Boyce]

## v7.0.0 - 2018-08-06

* Convert remaining coffee src + tests to typescript #92 [Will Boyce]

## v6.3.1 - 2018-07-05

* Move to latest version of `resin-base` to include MDNS support. #121 [Heds Simons]

## v6.3.0 - 2018-06-08

* Remove haproxy-specific rsyslog configuration #119 [Will Boyce]

## v6.2.1 - 2018-04-19

* Sync confd env backend configuration #117 [Michael Angelos Simos]

## v6.2.0 - 2018-04-12

* Add confd envvar backend configuration. #105 [Michael Angelos Simos]

## v6.1.1 - 2018-04-12

* Move to using `balena-root-ca.service` unit file in `resin-base` to handle self-signed CAs. #111 [Heds Simons]

## v6.1.0 - 2018-04-02

* Use resin-api v4 endpoints #109 [Will Boyce]

## v6.0.1 - 2018-03-27

* Expose addition healthcheck service accepting PROXY #108 [Will Boyce]

## v6.0.0 - 2018-03-27

* Update haproxy PROXY configuration (default: false) #106 [Will Boyce]

## v5.2.1 - 2018-03-23

* Further haproxy config updates + opimisations #107 [Will Boyce]

## v5.2.0 - 2018-03-22

* Update haproxy and optimise configuration #103 [Will Boyce]

## v5.1.1 - 2018-03-21

* Update libnss-openvpn fixing file descriptor leak #102 [Will Boyce]

## v5.1.0 - 2018-03-20

* Update base image to `resin-base:v3.3.0` #100 [Will Boyce]

## v5.0.0 - 2018-03-12

* Accept ProxyProtocol in haproxy and log IP mappings #95 [Will Boyce]

## v4.0.4 - 2018-03-06

* Suppress openvpn timestamps (as to avoid duplicates) #94 [Will Boyce]

## v4.0.3 - 2018-03-06

* Explicitly set `compress` algorithm to `lzo` #93 [Will Boyce]

## v4.0.2 - 2018-03-05

* Remove deprecated options from openvpn config #88 [Will Boyce]

## v4.0.1 - 2018-02-21

* Improve netmask splitting and related tests #91 [Will Boyce]

## v4.0.0 - 2018-02-20

* Vertical scaling of resin-vpn and openvpn services #40 [Will Boyce]

## v3.4.3 - 2018-02-14

* Report version on startup (and fix sentry release tracking) #90 [Will Boyce]

## v3.4.2 - 2018-02-08

* Log device state when successfully updated #86 [Will Boyce]

## v3.4.1 - 2018-02-06

* Allow override of OpenVPN keepalive values via env #84 [Will Boyce]

## v3.4.0 - 2018-01-12

* Update OpenVPN (2.4) and OpenSSL (1.0.2) #82 [Will Boyce]

## v3.3.0 - 2017-12-15

* Use clustering in connect proxy #79 [Will Boyce]

## v3.2.0 - 2017-12-15

* Rewrite connect proxy in typescript and update node-tunnel #77 [Will Boyce]

## v3.1.0 - 2017-12-15

* Log uuid of device when auth fails #78 [Will Boyce]

## v3.0.10 - 2017-12-14

* Use `typed-error` for custom Error classes #75 [Will Boyce]

## v3.0.9 - 2017-12-13

* Avoid flooding API with requests when many devices (dis)connect #73 [John (Jack) Brown]

## v3.0.8 - 2017-12-12

* Auto-deploy master branch builds to staging #72 [Will Boyce]

## v3.0.7 - 2017-11-29

* Add ability to use trusted self-signed root CAs in the VPN service, for the OnPrem solution. #66 [Heds Simons]

## v3.0.6 - 2017-11-27

* Do not report `HandledTunnelingError` to Sentry #70 [Will Boyce]

## v3.0.5 - 2017-11-21

* Rotate openvpn keys; add Makefile for key management #67 [John (Jack) Brown]

## v3.0.4 - 2017-10-31

* Update base image to `resin-base:v2.9.2` #63 [Will Boyce]

## v3.0.3 - 2017-10-23

* Update to pinejs-client ^4.2.3 #62 [Pagan Gazzard]

## v3.0.2 - 2017-10-17

* Simplify errors.ts #60 [Pagan Gazzard]

## v3.0.1 - 2017-10-17

* `captureException` should use pre-configured `Raven` #58 [Will Boyce]
* Add tslint and fix lint errors #58 [Will Boyce]

## v3.0.0 - 2017-10-10

* Remove GET /api/v1/clients endpoint #54 [Will Boyce]

## v2.1.1 - 2017-10-10

* Report errors to sentry #38 [Will Boyce]

## v2.1.0 - 2017-10-06

* Start the typescript conversion; convert src/libs/post-pool to typescript #57 [Pagan Gazzard]

## v2.0.4 - 2017-09-04

* Add `Restart=always` directive to openvpn@.service #51 [Will Boyce]
* Set "max locked memory" limit to unlimited for openvpn service #51 [Will Boyce]

## v2.0.3 - 2017-08-03

* Remove jenkins scripts [Will Boyce]

## v2.0.2 - 2017-07-19

* Update `resin-lint` and fix lint errors [Will Boyce]

## v2.0.1 - 2017-06-30

* Add PR template [Kostas Lekkas]

## v2.0.0 - 2017-05-29

* Pull device information from the API using the v2 endpoint [Ariel Flesler]
* Remove reset-all, register service on API, include service ID on connect & disconnect requests [Ariel Flesler]

## v1.3.2 - 2017-05-25

* Add circle ci config [Will Boyce]

## v1.3.1 - 2017-05-16

* Lint the code only on prepush hook, before running the tests [Ariel Flesler]

## v1.3.0 - 2017-05-16

* Change base image to resin-base:2, remove resin-jwt dependency and use api key-based authentication [Kostas Lekkas]

## v1.2.1 - 2017-05-16

* Hotfix: resolve promise chain before recursing [Petros Angelatos]

## v1.2.0 - 2017-05-15

* Update openvpn config [Will Boyce]

## v1.1.2 - 2017-05-10

* Add a Promise.timeout for connect/disconnect events [Pagan Gazzard]

## v1.1.1 - 2017-04-07

* Implement linting on precommit and fast tests on prepush [Ariel Flesler]

## v1.1.0 - 2017-03-21

* Revert "apply fix for small sndbuf/rcvbuf in openvpn" [Will Boyce]
* Apply fix for small sndbuf/rcvbuf in openvpn [Will Boyce]

## v1.0.0 - 2017-02-23

* Changed the queuing logic so that it is per device, and will only send the latest state. [Internal] [Page]
* Removed reset-all when updating device state fails, just retry until it succeeds. [Internal] [Page]
* Fixed a `TypeError: Cannot read property 'statusCode' of undefined` error. [Internal] [Page]

# 2016-10-10

* Defined timeouts on all requests, to help with hung connections. [Internal] [Page]
* Decreased amount of times to retry a request, so it doesn't retry essentially forever. [Internal] [Page]
* Increased max clients to 32768 [Internal] [Page]

# 2016-06-28

* Fix unused and undefined variables [Internal] [Kostas]
* Added bw_by_user.sh script for calculating the bandwidth used by user's devices on VPN [Internal] [Praneeth]

# 2016-06-01

* Update to node-tunnel@0.2.2 - Fix eternal FIN-WAIT-2 by dropping support for half-closed connections [External][Kostas]
* Improved tunneling error logging [Internal] [Kostas]

# 2016-05-11

* Use forked libnss-openvpn to fix leaked file descriptors. [Internal] [Aleksis]

# 2016-04-27

* Whitelist device port 22222 for proxy api key [External] [Kostas]
* Remove legacy activePort so that resin-vpn can safely be restarted. [Internal] [Aleksis]
* Use resin-lint [Internal] [Kostas]
* Remove device port 4200 from web access whitelist [External] [Kostas]
* Updated dependencies [Internal] [Page]
* Reduce noise in logs [Internal] [Kostas]
* Always restart resin-vpn.service if process exits or is killed. [Internal] [Kostas]

# 2016-01-20

* Wait a while after starting VPN to do the reset-all, to reduce the number of devices that appear offline during the mass reconnect. [Internal] [Page]
* Fixed client events http status code check. [Internal] [Aleksis]
* Update pinejs-client to include the escaping fix. [Internal] [Page]
* Updated to the new resin-base. [Internal] [Page]

# 2015-01-05

* Use the uuid to connect to the device, rather than relying on the api reported vpn_address which may be incorrect. [Internal] [Page]

# 2015-12-01

* Updated the vpn server certificate for another two years, to `Nov 23 16:10:32 2017 GMT` [Internal] [Page]
* Switched to a purely etcd backed confd. [Internal] [Page]
* Updated resin-base to include nodejs v4. [Internal] [Page]
* Removed reverse-proxy as it's going to continue living in resin-proxy with fixes. [Internal] [Page]

# 2015-11-12

* Allow connecting to devices via uuid rather than ip, using `${uuid}.vpn` [Internal] [Page]
* Fix the grammar of the proxy error pages. [Page]

# 2015-10-01

* Added winston logging module and improved logging on tunnel requests.
* Fixed an rsyslogd infinite restart loop when there is no logentries token. [Page]

# 2015-08-17

* Use JWT to authenticate requests from the API. [Aleksis]
* Try to populate the docker cache before building. [Page]
* Switched to using a tagged version of resin-base. [Page]

# 2015-07-26

* Added a /ping endpoint. [Aleksis]
* Switched to http/1.0 for the reverse proxy - necessary for some nc versions (eg OSX). [Aleksis]
* Always used the short commit hash for tagging. [Petros]
* Improved test script. [Aleksis]
* Switched logentries to TLS. [Petros]
* Switched to using some published modules. [Aleksis]
* Added VPN reverse proxy. [Aleksis]
* Report additional data on auth fail. [Lorenzo]

# 2015-07-17

* Changed to support newer resin-base with confd 0.10.0 [Page]
* Added VPN proxy. [Aleksis]
* Cleaned up openvpn-nc. [Aleksis]
* Disable autogeneration of openvpn services. [Petros]

# 2015-06-10

* Fix reset-all error handler [Aleksis]
* Fix VPN race condition causing incorrect online/offline state [petrosagg]
* Use less aggressive keepalive settings [petrosagg]

# 2015-05-13

v0.1.1
* Request API to reset all clients state when VPN starts and on event message failure. [Aleksis]
* Fix race condition of /dev/net/tun device node creation [petrosagg]
* Fix typo in client authentication [Page]

v0.1.0
* Switched to using resin-base. [Aleksis]
* Improved tests and made them able to be run by jenkins. [Aleksis]
