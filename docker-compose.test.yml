
services:
  main:
    image: sut
    privileged: true
    cap_add:
      - NET_ADMIN
    tmpfs:
      - /run
      - /sys/fs/cgroup
    volumes:
      - ./src:/usr/src/app/src:ro
      - ./test:/usr/src/app/test:ro
      - ./typings:/usr/src/app/typings:ro
      - ./tsconfig.json:/usr/src/app/tsconfig.json:ro
    extra_hosts:
      - "deadbeef.vpn:127.0.0.1"
    environment:
      - PRODUCTION_MODE=false
      - API_HOST=api.balena.test
      - VPN_PORT=443
      - VPN_BASE_SUBNET=100.64.0.0/10
      - VPN_INSTANCE_SUBNET_BITMASK=20
      - VPN_BASE_PORT=10000
      - VPN_BASE_MANAGEMENT_PORT=20000
      - VPN_API_PORT=30000
      - VPN_DOWNRATE=5mbit
      - VPN_UPRATE=5mbit
      - VPN_HOST=127.0.0.1
      - VPN_CONNECT_INSTANCE_COUNT=1
      - VPN_CONNECT_PROXY_PORT=3128
      - VPN_SERVICE_API_KEY=test_vpn_key
      - VPN_FORWARD_PROXY_PORT=3128
      - BALENA_API_HOST=api.balena.example
      - BALENA_API_INTERNAL_HOST=api.balena.local
      - DEFAULT_SIGTERM_TIMEOUT=120
      - DEFAULT_VERBOSE_LOGS=true
      - BLUEBIRD_DEBUG=1
      - TS_NODE_FILES=true
      - LEARN_ADDRESS_DEBUG=true
      - ROOT_CA=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURVekNDQWp1Z0F3SUJBZ0lVRHdTNDdKQUFBQ1JhMnpGL0tlamJ6ZWRuckZ3d0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dERVdNQlFHQTFVRUF3d05ZMkV1Y21WemFXNHVkR1Z6ZERBZ0Z3MHlNREV3TVRZeE9ERTVNVEJhR0E4eQpNVEl3TURreU1qRTRNVGt4TUZvd0dERVdNQlFHQTFVRUF3d05ZMkV1Y21WemFXNHVkR1Z6ZERDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUxmdm9HdXU3TS9oeHNudGdRMXJvV2dyV0ZxWmgrU08KOVlMMVhQUFFMWTVsMFFlcXpOVTRiYU1QWFB1dU8xTWgzaUhTWXFqV1B2UXNxWTFVc2NBRGJNT0ozK3NLRzRpQgpNU1pMZE1oTjhwdm9JSnl3RVVlNW1GaUg3Q2pYazBNd0VvQ1VhUHRIdnFPT29GdVUxTld3bnJiUTdDbXdNRTRLCjVjT1VxOHAwVFNqa3BpeEJCd0tiMERsZWU4VEZ1azUwY1BXK1hheEl6bUJWMmRSTitXRDY4ZStrZkxyNWxjMzcKMUs0V2lQbytNUmJLb1gwMUlxUW15bC9BUng3THB4dCtQR2FWL1pDNFQ1dnFBaVdPUkRESTVYSzJWOHJHVFEzeApBMkR4OEVsSlpwKzlybG1Ca0ZieWQyMC9zMWZSckMvelcxK2VyaEhhbVhacTFlR1FaTEFqT0pVQ0F3RUFBYU9CCmtqQ0JqekFkQmdOVkhRNEVGZ1FVNDJRdk1tNW9ONVlFMHpSK1ZSdFlCVWJsMFpzd1V3WURWUjBqQkV3d1NvQVUKNDJRdk1tNW9ONVlFMHpSK1ZSdFlCVWJsMFp1aEhLUWFNQmd4RmpBVUJnTlZCQU1NRFdOaExuSmxjMmx1TG5SbApjM1NDRkE4RXVPeVFBQUFrV3RzeGZ5bm8yODNuWjZ4Y01Bd0dBMVVkRXdRRk1BTUJBZjh3Q3dZRFZSMFBCQVFECkFnRUdNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUNsSFFMU2F0YkY4YkpIczFsUisyVE1iRXlsZ0huVVFUbGkKOUZNWFJTWFVSOVlqbzBqMjF6eTc4UUxLankzeDdWRThSejdCaW13TjJTYmw5UGVpUTlRTXgwbU5WUUFMSzN6OAorMkNaOW03OFFLL3BaMmt3QkEyL0pRV3ZwZzlhdWpDR2pYY1dtSDlnMXlRWk9BaExsb3hkUmVZM3pVOFpWNmxICndMYWxhVlp0WnhaVS93S3Jha3ZtTTJNVGd1eVFTb1pWcWRpcWp6TlBDbDJWcTkxTlpta2xxTzY2YWp5aC83OTEKYXBoZEhVSmhKNmtDQUpQR0RIdjFERnpWSWs2NUdQOEJ6WU1HVTJudFF6N0dIdE9vSUYyd1BSQWRHMnRmaXcxZwpUai94aElzcUYvcHo1Ry9kRHVxK1NaTURJNnhOMHBiOTFFVzY2QWNmSnJ4aDlXVXZ3aTdqCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      - VPN_OPENVPN_CA_CRT=Q2VydGlmaWNhdGU6CiAgICBEYXRhOgogICAgICAgIFZlcnNpb246IDMgKDB4MikKICAgICAgICBTZXJpYWwgTnVtYmVyOgogICAgICAgICAgICA3ZTo4NTpkNzo5YTpjMTo3MDpmZTozZDo2MDo5OTo2NTo5NTo3NTphODo4OToxMAogICAgICAgIFNpZ25hdHVyZSBBbGdvcml0aG06IHNoYTI1NldpdGhSU0FFbmNyeXB0aW9uCiAgICAgICAgSXNzdWVyOiBDTj1jYS5yZXNpbi50ZXN0CiAgICAgICAgVmFsaWRpdHkKICAgICAgICAgICAgTm90IEJlZm9yZTogT2N0IDE2IDE4OjI2OjQ5IDIwMjAgR01UCiAgICAgICAgICAgIE5vdCBBZnRlciA6IFNlcCAyMiAxODoyNjo0OSAyMTIwIEdNVAogICAgICAgIFN1YmplY3Q6IENOPXZwbi1jYS5yZXNpbi50ZXN0CiAgICAgICAgU3ViamVjdCBQdWJsaWMgS2V5IEluZm86CiAgICAgICAgICAgIFB1YmxpYyBLZXkgQWxnb3JpdGhtOiByc2FFbmNyeXB0aW9uCiAgICAgICAgICAgICAgICBSU0EgUHVibGljLUtleTogKDIwNDggYml0KQogICAgICAgICAgICAgICAgTW9kdWx1czoKICAgICAgICAgICAgICAgICAgICAwMDpkOTphYTo3OTowMjpmMDo5Yzo4ZDo3ZjoxZTowNDozNTpkYjo1NTo0ODoKICAgICAgICAgICAgICAgICAgICBhZDpiOTo2YToyNzo2NTpiMDphNjo0NTo5Yjo4ODo5NjowYjpmMjo2ZDo5ZjoKICAgICAgICAgICAgICAgICAgICBjZDo5NDpjMDoyYTpiZTpjYzo0Mjo1NDo4YzpmOTo3OTo0ODplMDoyZTpjNDoKICAgICAgICAgICAgICAgICAgICA3MTo2YzpkZTozMzo0YTpkNzo1NzowOTpjODo4MTo2MTo3NTozYjphODo1YzoKICAgICAgICAgICAgICAgICAgICBlYTpmNDoyZTo1MjoyMzpkMzo4NjpiNjpjMTo1OTpjZTozZTpmODo0NTphNDoKICAgICAgICAgICAgICAgICAgICBkMzpiNDoxMTowYjo2ODpkODo2Mjo4ZDoyMDpjMTplYTo3ODplNDo2Njo4YToKICAgICAgICAgICAgICAgICAgICA5ODphZjo0ODpiMDo1YjphMTplMTo3OTo3ZjoxMjo2ZTowMDpmOTo3ZTo1ZDoKICAgICAgICAgICAgICAgICAgICBhMTpjZDo4Mjo2ZDplMTo5ODpkNzo3Yjo0OTo4MDo1NDpiNjowNjplZjozYjoKICAgICAgICAgICAgICAgICAgICA2MzpiMzowYjplNTplZDoxYjo3MDo2NDpkMTplZDo1ZTowZjo5OTo3YjpjZDoKICAgICAgICAgICAgICAgICAgICBlYzo3ODpiMzo2Yzo0MDo2Mzo1MjowMzozYTphNzo3Mjo4MDpiMToxNDpmNDoKICAgICAgICAgICAgICAgICAgICA5MDo5YzpjNDo3ZDowYjowZDpjMTo1MTphMzowZDowNzo1ZDo2ODoxNDphNToKICAgICAgICAgICAgICAgICAgICBkZDpkZDo0YTo1ODo3MDo5OTo5OTo4OTo3YTo1ZTphZDo3MTpkYTo3MTplNzoKICAgICAgICAgICAgICAgICAgICA3YTphNzpkYjplZjo2MDplMjpmMzo3ZTo4NDoxZDoxYTplNzowYTpiZDphODoKICAgICAgICAgICAgICAgICAgICA5ZTpiOTozMTo2NDoyZjozYzo5ZDo0ZjowNTphMToyMDo0MjpmNToxZTpkOToKICAgICAgICAgICAgICAgICAgICA1ODozNTowYzo1YjpkNzpmMTo2MToxYjpmMDpkMjoyNjozYjo0MTowNTo2ZDoKICAgICAgICAgICAgICAgICAgICBiMTozZToxZTo1ZTplNzo1ZTo1ZDphNjowMzphNjozYjo1YTplOTo3ODozNDoKICAgICAgICAgICAgICAgICAgICBkYToxNDo4YzpiZDo4NDpmMzphZDozYjo1YjozMzo5NDo0NjpkOTo3ODo5NjoKICAgICAgICAgICAgICAgICAgICA3MDo4ZgogICAgICAgICAgICAgICAgRXhwb25lbnQ6IDY1NTM3ICgweDEwMDAxKQogICAgICAgIFg1MDl2MyBleHRlbnNpb25zOgogICAgICAgICAgICBYNTA5djMgQmFzaWMgQ29uc3RyYWludHM6IAogICAgICAgICAgICAgICAgQ0E6VFJVRQogICAgICAgICAgICBYNTA5djMgU3ViamVjdCBLZXkgSWRlbnRpZmllcjogCiAgICAgICAgICAgICAgICBFMTo1RjpDQzowMDpFRjoxRDpGNToxQzo3NzoyNjpGNTo4Mzo5NDozRTo2OTpGNjpFMTo1MDoxQTpBRgogICAgICAgICAgICBYNTA5djMgQXV0aG9yaXR5IEtleSBJZGVudGlmaWVyOiAKICAgICAgICAgICAgICAgIGtleWlkOkUzOjY0OjJGOjMyOjZFOjY4OjM3Ojk2OjA0OkQzOjM0OjdFOjU1OjFCOjU4OjA1OjQ2OkU1OkQxOjlCCiAgICAgICAgICAgICAgICBEaXJOYW1lOi9DTj1jYS5yZXNpbi50ZXN0CiAgICAgICAgICAgICAgICBzZXJpYWw6MEY6MDQ6Qjg6RUM6OTA6MDA6MDA6MjQ6NUE6REI6MzE6N0Y6Mjk6RTg6REI6Q0Q6RTc6Njc6QUM6NUMKCiAgICAgICAgICAgIFg1MDl2MyBLZXkgVXNhZ2U6IAogICAgICAgICAgICAgICAgQ2VydGlmaWNhdGUgU2lnbiwgQ1JMIFNpZ24KICAgIFNpZ25hdHVyZSBBbGdvcml0aG06IHNoYTI1NldpdGhSU0FFbmNyeXB0aW9uCiAgICAgICAgIDEwOmI5OjI1Ojc2OmM4Ojk3OmVkOjM0OjZkOjRiOjM1OmRkOmVkOjExOjVhOmQ5OmU1OmVlOgogICAgICAgICA5MTo2ZDoyYTplMDoyNzoxNDo0ZTo5OTo1MjphNjo0Zjo2Mzo1MTo0NzpjMDpiNTo0YToyMToKICAgICAgICAgMGE6YjI6N2U6OWQ6YTc6Y2Y6MzI6ZjU6N2E6MmU6MTE6YzQ6NTY6YmU6ODE6Yzg6NDg6ZDI6CiAgICAgICAgIDkzOjM4OmRlOmUzOjRlOjI5Ojc0OjlhOjUyOjc1OjBhOmRhOmM4OjMwOmMwOjg2OmUzOjBiOgogICAgICAgICBhZTplZDoxYjowMzo2MjpiZDo2MzpkMTozYToyYTpiMDo0MjozNjo3ZTpkMjo4ZjoyNTpkYToKICAgICAgICAgYjI6NjM6MGM6OWE6NTQ6ZmI6NjM6NmQ6OTc6MzI6ZDE6YTI6YjE6OTU6YjM6ZTY6Mjg6NWM6CiAgICAgICAgIDlhOmM1OmZkOjZiOmY4OmFjOmFmOjQxOjA0OjM3OjdkOjI5OjIzOjM3OjJhOjEyOmIxOjY3OgogICAgICAgICBiZjo4MzpiOTpkMzo2NDo2ODphZjphNDpiZjpkZDpiYzozYjo5YjplODoyNTo1MToxODo5MToKICAgICAgICAgOWE6Nzk6Yzc6MGE6MTg6OTE6ODY6OTM6MTk6YmY6OWI6MmU6N2M6ZGI6ODI6ZDk6OGY6NzM6CiAgICAgICAgIDJiOjNkOjAzOmQ0OmJlOmIzOjQ2OmUxOmIyOmE1OjMyOjM5OmM2OmFiOmIyOjYzOmY3OmYzOgogICAgICAgICBlZDo3MTplYjpkYzpkMTo0MjpiNDo2MToyMDplMToyOTpjZDphNTpiYzoyNzozZTowYjoyODoKICAgICAgICAgOTg6MGY6MjY6ZGY6NmY6YWI6NDA6NDI6OWU6MTk6OTc6MzY6NjU6MzQ6NmI6Yzg6MWI6YTg6CiAgICAgICAgIGU4OjM3OjIwOmY2OjliOjRiOmRiOmJhOjZhOmQ1OjY1OmI4OmRiOjkwOjljOmY2Ojk0Ojk1OgogICAgICAgICBiZTo0MjpiNjo4ZjpkNDpiOTozNzpjNjo0NToxMToxYTplMTo0Yzo3MDo1NjplMjphYTpmZDoKICAgICAgICAgZGY6OWM6ZjI6MjgKLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURVekNDQWp1Z0F3SUJBZ0lRZm9YWG1zRncvajFnbVdXVmRhaUpFREFOQmdrcWhraUc5dzBCQVFzRkFEQVkKTVJZd0ZBWURWUVFEREExallTNXlaWE5wYmk1MFpYTjBNQ0FYRFRJd01UQXhOakU0TWpZME9Wb1lEekl4TWpBdwpPVEl5TVRneU5qUTVXakFjTVJvd0dBWURWUVFEREJGMmNHNHRZMkV1Y21WemFXNHVkR1Z6ZERDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU5tcWVRTHduSTEvSGdRMTIxVklyYmxxSjJXd3BrV2IKaUpZTDhtMmZ6WlRBS3I3TVFsU00rWGxJNEM3RWNXemVNMHJYVnduSWdXRjFPNmhjNnZRdVVpUFRocmJCV2M0KworRVdrMDdRUkMyallZbzBnd2VwNDVHYUttSzlJc0Z1aDRYbC9FbTRBK1g1ZG9jMkNiZUdZMTN0SmdGUzJCdTg3Clk3TUw1ZTBiY0dUUjdWNFBtWHZON0hpemJFQmpVZ002cDNLQXNSVDBrSnpFZlFzTndWR2pEUWRkYUJTbDNkMUsKV0hDWm1ZbDZYcTF4Mm5IbmVxZmI3MkRpODM2RUhScm5DcjJvbnJreFpDODhuVThGb1NCQzlSN1pXRFVNVzlmeApZUnZ3MGlZN1FRVnRzVDRlWHVkZVhhWURwanRhNlhnMDJoU012WVR6clR0Yk01UkcyWGlXY0k4Q0F3RUFBYU9CCmtqQ0JqekFNQmdOVkhSTUVCVEFEQVFIL01CMEdBMVVkRGdRV0JCVGhYOHdBN3gzMUhIY205WU9VUG1uMjRWQWEKcnpCVEJnTlZIU01FVERCS2dCVGpaQzh5Ym1nM2xnVFROSDVWRzFnRlJ1WFJtNkVjcEJvd0dERVdNQlFHQTFVRQpBd3dOWTJFdWNtVnphVzR1ZEdWemRJSVVEd1M0N0pBQUFDUmEyekYvS2VqYnplZG5yRnd3Q3dZRFZSMFBCQVFECkFnRUdNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUFRdVNWMnlKZnRORzFMTmQzdEVWclo1ZTZSYlNyZ0p4Uk8KbVZLbVQyTlJSOEMxU2lFS3NuNmRwODh5OVhvdUVjUld2b0hJU05LVE9ON2pUaWwwbWxKMUN0cklNTUNHNHd1dQo3UnNEWXIxajBUb3FzRUkyZnRLUEpkcXlZd3lhVlB0amJaY3kwYUt4bGJQbUtGeWF4ZjFyK0t5dlFRUTNmU2tqCk55b1NzV2UvZzduVFpHaXZwTC9kdkR1YjZDVlJHSkdhZWNjS0dKR0dreG0vbXk1ODI0TFpqM01yUFFQVXZyTkcKNGJLbE1qbkdxN0pqOS9QdGNldmMwVUswWVNEaEtjMmx2Q2MrQ3lpWUR5YmZiNnRBUXA0Wmx6WmxOR3ZJRzZqbwpOeUQybTB2YnVtclZaYmpia0p6MmxKVytRcmFQMUxrM3hrVVJHdUZNY0ZiaXF2M2ZuUElvCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      - VPN_OPENVPN_SERVER_CRT=Q2VydGlmaWNhdGU6CiAgICBEYXRhOgogICAgICAgIFZlcnNpb246IDMgKDB4MikKICAgICAgICBTZXJpYWwgTnVtYmVyOgogICAgICAgICAgICBiNzpkMjo4OTplZjpjZTplNDo5YToxNzo5Nzo1MzpiYjo5NDo2ZjpmZDo0Mjo3ZgogICAgICAgIFNpZ25hdHVyZSBBbGdvcml0aG06IHNoYTI1NldpdGhSU0FFbmNyeXB0aW9uCiAgICAgICAgSXNzdWVyOiBDTj12cG4tY2EucmVzaW4udGVzdAogICAgICAgIFZhbGlkaXR5CiAgICAgICAgICAgIE5vdCBCZWZvcmU6IE9jdCAxNiAxODo0MToyMyAyMDIwIEdNVAogICAgICAgICAgICBOb3QgQWZ0ZXIgOiBTZXAgMjIgMTg6NDE6MjMgMjEyMCBHTVQKICAgICAgICBTdWJqZWN0OiBDTj12cG4ucmVzaW4udGVzdAogICAgICAgIFN1YmplY3QgUHVibGljIEtleSBJbmZvOgogICAgICAgICAgICBQdWJsaWMgS2V5IEFsZ29yaXRobTogcnNhRW5jcnlwdGlvbgogICAgICAgICAgICAgICAgUlNBIFB1YmxpYy1LZXk6ICgyMDQ4IGJpdCkKICAgICAgICAgICAgICAgIE1vZHVsdXM6CiAgICAgICAgICAgICAgICAgICAgMDA6Yjg6MDI6OTU6ZWE6OGM6NWU6YTA6M2Y6NDU6NjI6YTA6M2Q6NjY6NTI6CiAgICAgICAgICAgICAgICAgICAgNWE6ODA6YTA6NDk6MGM6ZWU6Mjc6NTA6Njk6NTY6OTc6YTI6Yzk6OTU6OTM6CiAgICAgICAgICAgICAgICAgICAgMzk6OWE6ZmE6MzY6NGY6MGE6N2Y6NDc6NGU6Mzg6MDE6YWY6NjQ6MWM6ZjY6CiAgICAgICAgICAgICAgICAgICAgZGI6YTI6MmI6Njg6YzA6ZjY6MGI6NGI6M2M6MDI6MzE6ZWI6NTM6NDM6Nzg6CiAgICAgICAgICAgICAgICAgICAgZDg6ZDg6OTU6MjU6MmQ6ZDM6NTM6Yzg6NmE6YWM6ZTE6MTE6NWM6M2M6ZWY6CiAgICAgICAgICAgICAgICAgICAgMzM6YTU6ODI6MmU6YWM6YjA6NzI6NDU6MTk6ZTg6M2I6NjY6MDY6YmM6NzM6CiAgICAgICAgICAgICAgICAgICAgNTc6MDY6ODc6NTM6MTk6YTg6M2M6MzA6Nzg6MTI6YTY6ODI6MDU6Mjg6ZWI6CiAgICAgICAgICAgICAgICAgICAgYjY6ZGI6OTc6YTc6Y2M6YmQ6ZjU6MzU6ZmQ6Y2M6YTY6MzM6MzY6OTI6NDA6CiAgICAgICAgICAgICAgICAgICAgZmU6NTk6NTc6NWY6ZDI6MmI6Mjc6MDk6NjY6ZmU6YzU6NTg6NTU6NDg6MjA6CiAgICAgICAgICAgICAgICAgICAgMmY6MjU6ZGU6NGU6MTY6ODY6ZDk6MDQ6MTE6OTA6MzU6NGI6N2Q6YWE6ZTY6CiAgICAgICAgICAgICAgICAgICAgZDE6OTU6M2U6ODk6NTA6MWQ6MTU6Mzk6Yjg6Nzg6NjA6ZDU6MTI6ZDk6MjM6CiAgICAgICAgICAgICAgICAgICAgYWQ6MjA6ODI6NDY6Mjg6ZTE6Yzg6MmU6ZGQ6ZWE6OWQ6NjY6YTg6OGU6Njc6CiAgICAgICAgICAgICAgICAgICAgMmU6Y2I6Y2M6NjA6ZWM6ZjU6ZDY6YTI6YzE6Zjc6MGY6Mzg6MmU6NmI6YmM6CiAgICAgICAgICAgICAgICAgICAgNzU6MTc6OTI6N2M6YzI6NWU6YjA6OTQ6Mzk6MWM6MTQ6NjI6MzI6OTc6NDE6CiAgICAgICAgICAgICAgICAgICAgM2E6M2Y6YmY6ZTk6YTA6Yzk6NTM6OTY6NTY6NDk6MzY6YjU6Yzg6ZTc6ZGY6CiAgICAgICAgICAgICAgICAgICAgMmY6ZDI6MDE6ZTA6OTM6OGU6Zjg6MGQ6NDY6NTU6ZTM6YWE6ODA6ZTg6MjQ6CiAgICAgICAgICAgICAgICAgICAgNDk6YWE6NDk6YTQ6YmM6M2Y6MGY6MWU6YTg6NTE6ODM6NDQ6YzU6M2Y6M2Q6CiAgICAgICAgICAgICAgICAgICAgYmE6OTEKICAgICAgICAgICAgICAgIEV4cG9uZW50OiA2NTUzNyAoMHgxMDAwMSkKICAgICAgICBYNTA5djMgZXh0ZW5zaW9uczoKICAgICAgICAgICAgWDUwOXYzIEJhc2ljIENvbnN0cmFpbnRzOiAKICAgICAgICAgICAgICAgIENBOkZBTFNFCiAgICAgICAgICAgIFg1MDl2MyBTdWJqZWN0IEtleSBJZGVudGlmaWVyOiAKICAgICAgICAgICAgICAgIEJFOjVDOjhDOkQ3OjhGOjNBOkE5OkY5OjE5OjI5OkE0OjdEOkY2OkU0OkZEOjI2OkM2OjE1OjhDOjQ1CiAgICAgICAgICAgIFg1MDl2MyBBdXRob3JpdHkgS2V5IElkZW50aWZpZXI6IAogICAgICAgICAgICAgICAga2V5aWQ6RTE6NUY6Q0M6MDA6RUY6MUQ6RjU6MUM6Nzc6MjY6RjU6ODM6OTQ6M0U6Njk6RjY6RTE6NTA6MUE6QUYKICAgICAgICAgICAgICAgIERpck5hbWU6L0NOPWNhLnJlc2luLnRlc3QKICAgICAgICAgICAgICAgIHNlcmlhbDo3RTo4NTpENzo5QTpDMTo3MDpGRTozRDo2MDo5OTo2NTo5NTo3NTpBODo4OToxMAoKICAgICAgICAgICAgWDUwOXYzIEV4dGVuZGVkIEtleSBVc2FnZTogCiAgICAgICAgICAgICAgICBUTFMgV2ViIFNlcnZlciBBdXRoZW50aWNhdGlvbgogICAgICAgICAgICBYNTA5djMgS2V5IFVzYWdlOiAKICAgICAgICAgICAgICAgIERpZ2l0YWwgU2lnbmF0dXJlLCBLZXkgRW5jaXBoZXJtZW50CiAgICAgICAgICAgIFg1MDl2MyBTdWJqZWN0IEFsdGVybmF0aXZlIE5hbWU6IAogICAgICAgICAgICAgICAgRE5TOnZwbi5yZXNpbi50ZXN0CiAgICBTaWduYXR1cmUgQWxnb3JpdGhtOiBzaGEyNTZXaXRoUlNBRW5jcnlwdGlvbgogICAgICAgICBhNDpiNTpjZTo5NDozNDo0NTplNTo4MjpiMzo0ZDo1Njo4MTpkZjozMjo0Yjo5OTpkYTplMToKICAgICAgICAgN2E6YTY6NGE6MjU6N2M6NDM6ODI6MjY6NzE6OTU6MGE6YmM6NzE6NGU6MjI6OTA6OWM6ZjA6CiAgICAgICAgIDFkOjI5Ojc0OmJjOjdlOjFlOjQ5OjU2Ojg2OjI0OmM3OjBiOmFmOmU5OjJhOjY1OjM3OjdiOgogICAgICAgICA5NTozMzpkODo0OTozMjo5ODpmMzpmODpiYTo1ZjpmYjplZDpkNzowMTphMjozNzpmYzo5YzoKICAgICAgICAgNTE6NmI6ZTM6NzI6MjA6YTQ6OGE6ZDA6MWI6OWU6MzI6MzQ6ZmE6MTQ6ZDc6MWU6MGM6MzE6CiAgICAgICAgIDYxOjdlOjA2Ojc3OjZjOmM2OjcwOjhmOjJkOjE4OjgxOmZhOjU1OmZjOmVmOjJlOjZhOjg0OgogICAgICAgICBlODpjZjoyYToxNjo1Nzo3ODpiMToxYzowMzo3MjoxYjphOTpkZDoxZjo1MToyZDpkMToyYzoKICAgICAgICAgODQ6NDU6ZmY6NGM6NmM6NWM6MGE6YzM6MGM6NzY6MzI6ZmY6YjY6OTE6ZGM6N2I6ZDg6Mzk6CiAgICAgICAgIDE0Ojg4OjFiOjBkOjc5OjNlOjJmOjY2OmZjOjVkOjQwOjAxOjA0OmU0OmJjOmY1Ojg1OmQ5OgogICAgICAgICAyOTo1ODo2YTplNDo5MDo5MDo0MDo0ZjpiZTowYzo1Yzo2OToyYTozMDo2Nzo5NzoxZjo1YToKICAgICAgICAgZGI6NDI6ZDI6YTM6MTA6ZmQ6YWE6MTk6NTk6YjI6YzE6NTU6MmM6MzI6MzA6N2Q6NDQ6MGE6CiAgICAgICAgIDM4OmQ5OjViOjIzOjdiOjlhOjVkOjIyOmM2OjE1Ojg4OjkwOjNiOmM4OmIwOjhhOmIzOmQ4OgogICAgICAgICAzODplNzo1MjpkMDplZDphOTpjMTo1Yzo4MDo2Zjo4Mzo5NDpkNDo0Yzo3ZDphMTplZTo2NToKICAgICAgICAgYTE6NmU6ODU6MTY6YzQ6N2E6MmM6ZWU6ODA6NmE6NjI6Yzc6YzM6MWQ6OGU6YTE6M2M6ZjU6CiAgICAgICAgIDc2OjVkOjhkOmY1Ci0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlEZmpDQ0FtYWdBd0lCQWdJUkFMZlNpZS9PNUpvWGwxTzdsRy85UW44d0RRWUpLb1pJaHZjTkFRRUxCUUF3CkhERWFNQmdHQTFVRUF3d1JkbkJ1TFdOaExuSmxjMmx1TG5SbGMzUXdJQmNOTWpBeE1ERTJNVGcwTVRJeldoZ1AKTWpFeU1EQTVNakl4T0RReE1qTmFNQmt4RnpBVkJnTlZCQU1NRG5ad2JpNXlaWE5wYmk1MFpYTjBNSUlCSWpBTgpCZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF1QUtWNm94ZW9EOUZZcUE5WmxKYWdLQkpETzRuClVHbFdsNkxKbFpNNW12bzJUd3AvUjA0NEFhOWtIUGJib2l0b3dQWUxTendDTWV0VFEzalkySlVsTGROVHlHcXMKNFJGY1BPOHpwWUl1ckxCeVJSbm9PMllHdkhOWEJvZFRHYWc4TUhnU3BvSUZLT3UyMjVlbnpMMzFOZjNNcGpNMgpra0QrV1ZkZjBpc25DV2IreFZoVlNDQXZKZDVPRm9iWkJCR1FOVXQ5cXViUmxUNkpVQjBWT2JoNFlOVVMyU090CklJSkdLT0hJTHQzcW5XYW9qbWN1eTh4ZzdQWFdvc0gzRHpndWE3eDFGNUo4d2w2d2xEa2NGR0l5bDBFNlA3L3AKb01sVGxsWkpOclhJNTk4djBnSGdrNDc0RFVaVjQ2cUE2Q1JKcWtta3ZEOFBIcWhSZzBURlB6MjZrUUlEQVFBQgpvNEc3TUlHNE1Ba0dBMVVkRXdRQ01BQXdIUVlEVlIwT0JCWUVGTDVjak5lUE9xbjVHU21rZmZiay9TYkdGWXhGCk1FOEdBMVVkSXdSSU1FYUFGT0ZmekFEdkhmVWNkeWIxZzVRK2FmYmhVQnF2b1J5a0dqQVlNUll3RkFZRFZRUUQKREExallTNXlaWE5wYmk1MFpYTjBnaEIraGRlYXdYRCtQV0NaWlpWMXFJa1FNQk1HQTFVZEpRUU1NQW9HQ0NzRwpBUVVGQndNQk1Bc0dBMVVkRHdRRUF3SUZvREFaQmdOVkhSRUVFakFRZ2c1MmNHNHVjbVZ6YVc0dWRHVnpkREFOCkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQXBMWE9sRFJGNVlLelRWYUIzekpMbWRyaGVxWktKWHhEZ2laeGxRcTgKY1U0aWtKendIU2wwdkg0ZVNWYUdKTWNMcitrcVpUZDdsVFBZU1RLWTgvaTZYL3Z0MXdHaU4veWNVV3ZqY2lDawppdEFibmpJMCtoVFhIZ3d4WVg0R2QyekdjSTh0R0lINlZmenZMbXFFNk04cUZsZDRzUndEY2h1cDNSOVJMZEVzCmhFWC9UR3hjQ3NNTWRqTC90cEhjZTlnNUZJZ2JEWGsrTDJiOFhVQUJCT1M4OVlYWktWaHE1SkNRUUUrK0RGeHAKS2pCbmx4OWEyMExTb3hEOXFobFpzc0ZWTERJd2ZVUUtPTmxiSTN1YVhTTEdGWWlRTzhpd2lyUFlPT2RTME8ycAp3VnlBYjRPVTFFeDlvZTVsb1c2RkZzUjZMTzZBYW1MSHd4Mk9vVHoxZGwyTjlRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
      - VPN_OPENVPN_SERVER_KEY=LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdUFLVjZveGVvRDlGWXFBOVpsSmFnS0JKRE80blVHbFdsNkxKbFpNNW12bzJUd3AvClIwNDRBYTlrSFBiYm9pdG93UFlMU3p3Q01ldFRRM2pZMkpVbExkTlR5R3FzNFJGY1BPOHpwWUl1ckxCeVJSbm8KTzJZR3ZITlhCb2RUR2FnOE1IZ1Nwb0lGS091MjI1ZW56TDMxTmYzTXBqTTJra0QrV1ZkZjBpc25DV2IreFZoVgpTQ0F2SmQ1T0ZvYlpCQkdRTlV0OXF1YlJsVDZKVUIwVk9iaDRZTlVTMlNPdElJSkdLT0hJTHQzcW5XYW9qbWN1Cnk4eGc3UFhXb3NIM0R6Z3VhN3gxRjVKOHdsNndsRGtjRkdJeWwwRTZQNy9wb01sVGxsWkpOclhJNTk4djBnSGcKazQ3NERVWlY0NnFBNkNSSnFrbWt2RDhQSHFoUmcwVEZQejI2a1FJREFRQUJBb0lCQUZpVXZoQ3NSRDFHV0NPVApXaHR3MTZxRi9zU2Z2UU5Ed25DNjUrbitkc081WWYySTR4NnpjOWl6MHpEeVVXYnZHTDJUZEhwaVIvZzUvZHBFClNiZHhqUFZUZjBqQ3ViaWJQOWtCbWM0NkxqZnB0UWk0NFFmL0pJMEJ4VW9hU1JIWDRDbkJFOUZlVkJlUDZYWXEKdXBlZ2RuUG9XdVZEVUNqMTZydWRpVDVHa2NNL0pKeHZQRkR1Vm9HT1Bpejh2VUhoOG4rTWRLcm1zRmJCTk5LZApTc3d4OEg2dUFCaGRTUGRtbFJGSTA5d3pETUJHQTdGM1dPVTY5NHQvYzFqNWhaY1ZTdVk2dURuKzk4Unl5b0tBCm05dm5mZGtqb3pIUzlLdU1uUzFYWnU3MWNsZyszVStOSFlWY1FTMlNsczJHV0EvR1BPVjhObTNyLy9uakJPUXMKbDM1R0pyRUNnWUVBOE1qSGw4YldTdElsVTNtdEhWY2lmR2JnRWNVbDJ0RlNVVkxxSXl6cGZ5clV2ODZMVDBzVAppVjZhaGh4N1RYQVdNRWpsTHR4SmxDa1dHN1RtMGhEUXpFcTNSVUV3MGFabStPdWVJMXVpeWlCY3paYUtaSEw2CjNJQ1M4L3VkUEExODJaUCtzdjAxcEFWa3A1UVFLVnp4bi9pNkR1RkpVdWNVcno4MFhCdjFEcDBDZ1lFQXc2TmIKZXNkL05UUW81UGhHbGRWTkduOGtoa2hRNXhPZ0xLRmlVbW1JanorakdhMlJyWGg2Wk4wdmg5Q0ZpL1NwYVY2aApLZ0Q5aWg0OFNyNmZscS95Y0hSb0Vxa1Y2Qkd1cGQ2YkFFZTBJNlF5N1o1b1drcFp1L096ek1DaGdIOVV5QWpnClNTWGVsZ2E3TVFJUGxPVTlsRkNESVduQzFhdzZrb25taHUwK3Y0VUNnWUFSQ2tTRnl6NlRJUGdmUmpjb0ltaUEKWVU5dU1vT1JUc3NDa2xtYmo2d2VvY3RZbjZkZ1B6SHN3Tk15dG9WTFg2bFNWWFpTc0toTVlmUDhsZnJYMXZUUAo0R0hEOXU4Ymh5azJhSVpTZmtPeEJrVkxEMkpQNVlzM1c2b0t0ajNVYUNmenhmTjZlMHoyaEtNdzhOdUw4ZFh2CnVreUFqUlVCVnZVeHljbE0wM1d1U1FLQmdGaUUwSDUwUjYxMkJVN2N1MnRPRU0zOVd6UmJBaWdiN0N4bGRReGUKN2NnSy9pdy9LWnY0MkVCTkNCV0dsdlpsWkVYbDZEd09LS25XMW1ibmEyUU9CajgxbkdWZEZpbGozc2IwT3VQYwpqYmhXc2locnRVR3RSSDdUWExZM0xwdnFnUnpsVHo0cG9WWDJnN28vK1hiZ1pvVjJERzhRNEhRM3NtVGRlbTN3CmFLVFZBb0dCQUplRlJUVnVLcG5NYVozU0thMkQrSksvd3gzOWdVTlFmOXVIT3RjRlVDVnh0WXJzbTFtdHhpU1cKTEJTODRMMVZGcnlESVpTK3A5NzY1NTllWG43R2lreFg5SVNUMDRRTzdxeVF6cFFobGQxZFEwNzdiWUsvR1YyUgpSN0YvWXBjb0owclVMYWZic0RuQy91WlpoUG82ZHFXdm5Xb3pMYVlNNUVXVXZJeFVuWWd5Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
      - VPN_OPENVPN_SERVER_DH=LS0tLS1CRUdJTiBESCBQQVJBTUVURVJTLS0tLS0KTUlJQkNBS0NBUUVBd0w4WXVleE1hWHdINlRPdkZYYStSdXVzUmpFLzY2YlZ6SithQzQ3dWRDdGxnQ045Vk9IbgpHVytscEZHb2pYaFhHMzhNNXJueXd2NXQ0dTB4blp5UTNnUndLeUtad24zM0p5R2NFT1RJRW0xdXQ5TE9uOVdhClFhbjJuWWRWRVFwYmJpTUh1cG9aRVozeFNKanV6NWQrNWtrcFVmWHVMQUxLQ3lyNSthamhBMjJLQzZ0bFBoUmMKeGlqWXZ5MUEyalFsNHVHeitRbStqZWIvNXdYQXl4cXFZOFZrN0s4OUFLeXk4d1Nid0lhdkJjendTdlFEMjZRawozNzNNbUFvMHBwUWVFaEE3RGlWTFNvZld5dW5NSFdxb241djZ4SDdnMVBjUHpySkdjdGFNR2p3WFJ2QmMxcUJuClNFakM2LzZBL0paTTVMZzkvZkhRNEpLbWtpM0EwWjU0WXdJQkFnPT0KLS0tLS1FTkQgREggUEFSQU1FVEVSUy0tLS0tCg==

  sut:
    image: docker:stable
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    depends_on:
      - main
    environment:
      CONTAINER_NAME: ${COMPOSE_PROJECT_NAME:-open-balena-vpn}-main-1
    entrypoint: /bin/sh
    command:
      - -exc
      - |
        sleep 10
        docker exec "$${CONTAINER_NAME}" npm install
        docker exec "$${CONTAINER_NAME}" npm run test-unit
        docker exec "$${CONTAINER_NAME}" npx mocha test/app.ts
        # Test the learn-address script directly
        docker exec "$${CONTAINER_NAME}" env LEARN_ADDRESS_DEBUG=true /usr/src/app/openvpn/scripts/learn-address.sh 10mbit 5mbit add 10.0.0.100 test-client debug lo
        # Check if log file was created and show its contents
        docker exec "$${CONTAINER_NAME}" ls -la /var/log/openvpn/
        docker exec "$${CONTAINER_NAME}" cat /var/log/openvpn/learn-address.log
