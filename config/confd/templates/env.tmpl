NODE_ENV={{if eq (getenv "PRODUCTION_MODE") "true"}}production{{else}}development{{end}}
NODE_EXTRA_CA_CERTS={{if getenv "ROOT_CA"}}/etc/ssl/certs/balenaRootCA.pem{{end}}

UV_THREADPOOL_SIZE=128

SENTRY_DSN={{ if getenv "SENTRY_DSN" }}{{ getenv "SENTRY_DSN" }}{{ else if getenv "VPN_SENTRY_DSN" }}{{ getenv "VPN_SENTRY_DSN" }}{{ end }}

BALENA_API_HOST={{getenv "API_HOST"}}
BALENA_API_INTERNAL_HOST={{getenv "API_INTERNAL_HOST"}}

IPTABLES_FORWARD_POLICY=DROP
VPN_BYTECOUNT_INTERVAL={{getenv "VPN_BYTECOUNT_INTERVAL" "60"}}
VPN_GATEWAY={{getenv "VPN_GATEWAY"}}
VPN_INSTANCE_COUNT={{ if eq (getenv "PRODUCTION_MODE") "true" }}{{ if eq (getenv "VPN_INSTANCE_COUNT" "0") "0" }}0{{ else if gt (getenv "VPN_INSTANCE_COUNT" "0") "0" }}{{ getenv "VPN_INSTANCE_COUNT" }}{{ else }}{{getenv "NPROC"}}{{ end }}{{ else }}1{{ end }}

# VPN_BASE_SUBNET will be divided into contiguous subnets of size VPN_INSTANCE_SUBNET_BITMASK
VPN_BASE_SUBNET={{ getenv "VPN_BASE_SUBNET" "100.64.0.0/10" }}
{{ if getenv "VPN_INSTANCE_SUBNET_BITMASK" }}VPN_INSTANCE_SUBNET_BITMASK={{ getenv "VPN_INSTANCE_SUBNET_BITMASK" }}{{ end }}
# VPN_INSTANCE_ID (1-indexed) added to BASE_PORT (usable ports from BASE_PORT+1)
VPN_BASE_PORT=10000
VPN_BASE_MANAGEMENT_PORT=20000
VPN_API_PORT=30000
{{ if getenv "VPN_STATUS_FILE_WRITE_INTERVAL_SECONDS" }}VPN_STATUS_FILE_WRITE_INTERVAL_SECONDS={{ getenv "VPN_STATUS_FILE_WRITE_INTERVAL_SECONDS" }}{{ end }}

VPN_CONNECT_INSTANCE_COUNT={{ if eq (getenv "PRODUCTION_MODE") "true" }}0{{ else }}1{{ end }}
VPN_CONNECT_PROXY_PORT=3128
VPN_FORWARD_PROXY_PORT={{if getenv "VPN_FORWARD_PROXY_PORT"}}"{{getenv "VPN_FORWARD_PROXY_PORT"}}"{{ else }}3128{{ end }}

VPN_HOST=127.0.0.1

VPN_SERVICE_API_KEY={{getenv "VPN_SERVICE_API_KEY"}}
VPN_GUEST_API_KEY={{getenv "VPN_GUEST_API_KEY"}}

MAX_API_POST_WORKERS=80
{{ if getenv "API_DEVICE_STATE_POST_BATCH_SIZE" }}API_DEVICE_STATE_POST_BATCH_SIZE={{ getenv "API_DEVICE_STATE_POST_BATCH_SIZE" }}{{ end }}

VPN_KEEPALIVE_FREQUENCY={{getenv "VPN_KEEPALIVE_FREQUENCY" "10"}}
VPN_KEEPALIVE_TIMEOUT={{getenv "VPN_KEEPALIVE_TIMEOUT" "60"}}

DEFAULT_VERBOSE_LOGS={{getenv "VPN_VERBOSE_LOGS" "true"}}

METRICS_TIMEOUT={{getenv "METRICS_TIMEOUT"}}

# seconds to wait between receiving SIGTERM and SIGKILL
DEFAULT_SIGTERM_TIMEOUT={{getenv "DEFAULT_SIGTERM_TIMEOUT" "120"}}
MINIMUM_DRAIN_RATE={{getenv "MINIMUM_DRAIN_RATE"}}

VPN_HAPROXY_SOCKET={{getenv "VPN_HAPROXY_SOCKET" "/run/haproxy.sock"}}

{{ if getenv "VPN_SERVICE_REGISTER_INTERFACE" }}VPN_SERVICE_REGISTER_INTERFACE={{ getenv "VPN_SERVICE_REGISTER_INTERFACE" }}{{ end }}

{{if getenv "TRUST_PROXY"}}TRUST_PROXY={{getenv "TRUST_PROXY"}}{{end}}
{{if getenv "VPN_AUTH_CACHE_TIMEOUT"}}VPN_AUTH_CACHE_TIMEOUT={{getenv "VPN_AUTH_CACHE_TIMEOUT"}}{{end}}

{{if getenv "DELAY_ON_AUTH_FAIL"}}DELAY_ON_AUTH_FAIL={{getenv "DELAY_ON_AUTH_FAIL"}}{{end}}

# Bandwidth throttling configuration - only enable if rates are specified
VPN_DOWNRATE={{getenv "VPN_DOWNRATE"}}
VPN_UPRATE={{getenv "VPN_UPRATE"}}

# Learn-address script configuration
LEARN_ADDRESS_DEBUG={{getenv "LEARN_ADDRESS_DEBUG" "false"}}
LEARN_ADDRESS_LOG_DIR={{getenv "LEARN_ADDRESS_LOG_DIR"}}
LEARN_ADDRESS_STATE_DIR={{getenv "LEARN_ADDRESS_STATE_DIR"}}
